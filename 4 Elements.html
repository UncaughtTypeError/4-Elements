<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width">
        <title>4 Elements</title>
        <script src="https://code.jquery.com/jquery-3.1.0.js"></script>
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.1.0/css/all.css" integrity="sha384-lKuwvrZot6UHsBSfcMvOkWwlCMgc0TaWr+30HWe3a4ltaBwTZhyTEggF5tJv8tbt" crossorigin="anonymous">
    </head>
    <body>
        <div class="wrapper">
            <div class="alert-component"><!-- epheremal altert and notice display --></div>
            <div class="overview-component">
                <div class="overview-deck-details"></div>
                <div class="overview-win-indicator">
                    <div class="overview-player-win">0</div>
                    <div class="npc-player-win">0</div>
                </div>
                <div class="overview-current-phase"></div>
            </div>
            <div class="turnCard-component">
                <div class="turnCard-bg-lines"><div><div></div></div></div>
                <div class="turnCard-match"></div>
                <div class="turnCard-selection"></div>
            </div>
            <div class="phaseGuide-component">
                <div class="phaseGuide inactive-phaseGuide">
                    <div class="phaseGuide-current-phase"></div>
                    <div class="phaseGuide-instruction"></div>
                </div>
            </div>
            <div class="field-component">
                <div class="field" data-field="ai-field">
                    <div class="preview-pane-component">
                        <div class="preview-pane-aperture">
                            <div class="preview-pane-dismiss"><i class="fas fa-times"></i></div>
                            <div class="preview-pane-card"></div>
                        </div>
                        <div class="preview-pane-aperture">
                            <div class="preview-pane-stats"></div>
                        </div>
                    </div>
                    <div class="deck-component">
                        <div class="victory-indicator">
                            <div class="victory-aperture"></div>
                            <div class="victory-aperture"></div>
                            <div class="victory-aperture"></div>
                        </div>
                        <div class="player-hand">
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                        </div>
                        <div class="dorment">
                            <div class="turn-indicator"></div>
                            <div class="stack-counter">
                                <span></span>
                                <div class="stack-circuit"></div>
                            </div>
                            <div class="standby-pile"></div>
                            <div class="dead-pile"></div>
                        </div>
                    </div>
                </div>
                <div class="battle-field-component">
                    <div class="battle-field-background">
                        <div class="background-panel-left background-panel">
                            <div class="panel-corner"></div>
                            <div class="panel-corner"></div>
                        </div>
                        <div class="background-panel-right background-panel">
                            <div class="panel-corner"></div>
                            <div class="panel-corner"></div>
                        </div>
                    </div>
                    <div class="resource-field-component" data-resource-field="player-field">
                        <div class="resource resource-pyro">
                            <i class="fas fa-burn"></i>
                            <div class="resource-aperture"></div>
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                        </div>
                        <div class="resource resource-terra">
                            <i class="fas fa-leaf"></i>
                            <div class="resource-aperture"></div>
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                        </div>
                        <div class="resource resource-aero">
                            <i class="fas fa-cloud"></i>
                            <div class="resource-aperture"></div>
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                        </div>
                        <div class="resource resource-hydro">
                            <i class="fas fa-tint"></i>
                            <div class="resource-aperture"></div>
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                        </div>
                    </div>
                    <div class="battle-field" data-battle-field="player-field">
                        <div class="hitpoint-indicator">
                            <div class="hitpoint-circuit"></div>
                            <div class="hitpoint-meter safe">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="hitpoint-meter caution">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="hitpoint-meter risk">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                        <div class="in-play"></div>
                        <div class="support-card-component">
                            <div class="support-card-circuit"></div>
                        </div>
                    </div>
                    <div class="battle-field" data-battle-field="ai-field">
                        <div class="support-card-component">
                            <div class="support-card-circuit"></div>
                        </div>
                        <div class="in-play"></div>
                        <div class="hitpoint-indicator">
                            <div class="hitpoint-circuit"></div>
                            <div class="hitpoint-meter safe">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="hitpoint-meter caution">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                            <div class="hitpoint-meter risk">
                                <div></div>
                                <div></div>
                                <div></div>
                            </div>
                        </div>
                    </div>
                    <div class="resource-field-component" data-resource-field="ai-field">
                        <div class="resource resource-hydro">
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                            <div class="resource-aperture"></div>
                            <i class="fas fa-tint"></i>
                        </div>
                        <div class="resource resource-aero">
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                            <div class="resource-aperture"></div>
                            <i class="fas fa-cloud"></i>
                        </div>
                        <div class="resource resource-terra">
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                            <div class="resource-aperture"></div>
                            <i class="fas fa-leaf"></i>
                        </div>
                        <div class="resource resource-pyro">
                            <div class="resource-counter" data-pool-wealth="0">0</div>
                            <div class="resource-aperture"></div>
                            <i class="fas fa-burn"></i>
                        </div>
                    </div>
                </div>
                <div class="field" data-field="player-field">
                    <div class="deck-component">
                        <div class="victory-indicator">
                            <div class="victory-aperture"></div>
                            <div class="victory-aperture"></div>
                            <div class="victory-aperture"></div>
                        </div>
                        <div class="player-hand">
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                            <div class="card-aperture open"></div>
                        </div>
                        <div class="dorment">
                            <div class="dead-pile"></div>
                            <div class="standby-pile"></div>
                            <div class="stack-counter">
                                <span></span>
                                <div class="stack-circuit"></div>
                            </div>
                            <div class="turn-indicator"></div>
                        </div>
                    </div>
                    <div class="preview-pane-component">
                        <div class="preview-pane-aperture">
                            <div class="preview-pane-dismiss"><i class="fas fa-times"></i></div>
                            <div class="preview-pane-card"></div>
                        </div>
                        <div class="preview-pane-aperture">
                            <div class="preview-pane-stats"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
            /*
            **
            ** Phases & Notifications
            **
            */

            // Phases
            var currentPhase            = 'turnSelectPhase',    // define the current phase for reference sake
                turnSelectPhase         = true,                 // determine turn order
                drawPhase               = false,                // draw cards for hand
                casterSelectionPhase    = false,                // select caster card and place into active play
                resourcePoolPhase       = false,                // add to resource pool to accrue spending points for support cards and levelling
                baseSwitchingPhase      = false,                // switch elemental base type if possible (pyro, hydro, terra, aero)
                supportSelectionPhase   = false,                // select support card and place into active play
                levellingPhase          = false,                // caster level up if possible (proficient, adept, elite, peerless)
                confirmHandPhase        = false,                // prompt player to confirm or discard drawn hand
                confirmCasterPhase      = false,                // prompt player to confirm or reject caster selection
                confirmResourcePhase    = false,                // prompt player to confirm or reject resource selection
                browseHandPhase         = false,                // allow player to browse hand
                previewSelectionPhase   = false,                // allow player to preview card
            // Notices
                invalidDrawNotice       = false,                // notify player of invalid draw (where no caster type cards are found)
                phaseGuideNotice        = false,                // notify player of current phase and provide instruction
            // Other
                activeDialogueBox       = false;                // indicate an active dialogue box

            /*
            **
            ** Globals
            **
            */
            var KeyDismissal,
                iterationDelay,
                iterationCount,
                remainingIterations;

            /*
            **
            ** Constants
            **
            */
                const   cardBack    =   `<div class="cardBack">
                                            <div class="card-motivs">
                                                <i class="fas fa-burn"></i>
                                                <i class="fas fa-leaf"></i>
                                                <i class="fas fa-cloud"></i>
                                                <i class="fas fa-tint"></i>
                                            </div>
                                            <div class="card-logo">Elemental</div>
                                        </div>`,
                        dialogueBox =   `<div class="dialogueBox inactive-dialogueBox" style="z-index: 0;">
                                            <div class="dialogueBox-component">
                                                <div class="dialogueBox-head">
                                                    <div class="dialogueBox-maximize dialogueBox-control"><i class="far fa-window-maximize"></i></div>
                                                    <div class="dialogueBox-minimize dialogueBox-control"><i class="far fa-window-minimize"></i></div>
                                                    <div class="dialogueBox-dismiss dialogueBox-control"><i class="fas fa-times"></i></div>
                                                </div>
                                                <div class="dialogueBox-body"></div>
                                                <div class="dialogueBox-backgraound">
                                                    <div class="card-motivs">
                                                        <i class="fas fa-burn"></i>
                                                        <i class="fas fa-leaf"></i>
                                                        <i class="fas fa-cloud"></i>
                                                        <i class="fas fa-tint"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="dialogueBox-backdrop"></div>
                                        </div>`;

            /*
            **
            ** Phase Guide & Indication
            **
            */
            var guideInstruction;

            // Phase guide update
            function updatePhaseGuide(guideInstruction,instancePhase) {

                if(!phaseGuideNotice) {

                    // Separate string by every capital letter
                    let currentPhaseIndicator = currentPhase.split(/(?=[A-Z])/);

                    // Set current phase
                    jQuery('.phaseGuide-current-phase').html(currentPhaseIndicator.join(' '));

                    // Set phase instruction
                    jQuery('.phaseGuide-instruction').append(guideInstruction);

                    jQuery('.phaseGuide').removeClass('inactive-phaseGuide').addClass('active-phaseGuide');

                    phaseGuideNotice = true;

                } else if(phaseGuideNotice) { // if the phase guide already exists, clear it, dismiss it, delay it, then call it again

                    phaseGuideNotice = false;

                    jQuery('.phaseGuide').removeClass('active-phaseGuide').addClass('inactive-phaseGuide');
                    jQuery('.phaseGuide-instruction').empty();

                    setTimeout(function(){

                        if(instancePhase == currentPhase) { // check if current phase is still the same phase at instance of initialisation

                            // Separate string by every capital letter
                            let currentPhaseIndicator = currentPhase.split(/(?=[A-Z])/);

                            // Set current phase
                            jQuery('.phaseGuide-current-phase').html(currentPhaseIndicator.join(' '));

                            // Set phase instruction
                            jQuery('.phaseGuide-instruction').append(guideInstruction);

                            jQuery('.phaseGuide').removeClass('inactive-phaseGuide').addClass('active-phaseGuide');

                            phaseGuideNotice = true;

                        }

                    },1000);

                }

            }

            // Phase guide dismissal
            function dismissPhaseGuide() {

                phaseGuideNotice = false;

                jQuery('.phaseGuide').removeClass('active-phaseGuide').addClass('inactive-phaseGuide');
                jQuery('.phaseGuide-instruction').empty();

            }

            // Phase indicator update
            function updatePhaseIndicator() {

                // Separate string by every capital letter
                let currentPhaseIndicator = currentPhase.split(/(?=[A-Z])/);

                // Set current phase
                jQuery('.overview-current-phase').html(currentPhaseIndicator.join(' '));

            }

            // Update phase indicator on initialization
            updatePhaseIndicator();

            /*
            **
            ** Dialogue Box Logic
            **
            */
            var dialogueBoxContent;

            // Insert Dialogue Box into DOM if not already present 
            if (jQuery('.dialogueBox').length <= 0) {
                jQuery(dialogueBox).prependTo('.wrapper');
            }

            // Call/Dismiss Dialogue Box
            function toggleDialogueBox(windowControl,allowKeyDismissal) {

                if (jQuery('.dialogueBox').hasClass('active-dialogueBox')) { // hide the dialogue box

                    jQuery('.dialogueBox').toggleClass('active-dialogueBox inactive-dialogueBox');
                    jQuery('.dialogueBox').removeClass('minimized-dialogueBox maximized-dialogueBox');

                    activeDialogueBox = false; // define the dialogue box state
                    dialogueBoxContent = null; // reset the dialogue box content storage variable
                    KeyDismissal = false; // disable dialogue box key dismissal

                    // allow time for the closing animations to complete
                    setTimeout(function(){
                        jQuery('.dialogueBox').css('z-index','0');
                        jQuery('.dialogueBox-body').empty(); // empty the body of the dialogue box in preparation for future use
                    },500);

                    // run callback function based on the current phase
                    if (turnSelectPhase) {
                        endTurnSelectPhase();
                    } else if (invalidDrawNotice) {
                        dismissInvalidDrawNotice(); // dismiss invalid draw notice
                    }

                } else if (jQuery('.dialogueBox').hasClass('inactive-dialogueBox')) { // display the dialogue box

                    if(windowControl) { // determine if window control is required
                        jQuery('.dialogueBox-minimize').show();
                        jQuery('.dialogueBox').addClass('maximized-dialogueBox');
                    } else if(!windowControl) {
                        jQuery('.dialogueBox').removeClass('maximized-dialogueBox');
                        jQuery('.dialogueBox-minimize').hide();
                    }

                    if(dialogueBoxContent != null) { // only display the dialogue box if content has been defined

                        jQuery('.dialogueBox').toggleClass('active-dialogueBox inactive-dialogueBox');

                        activeDialogueBox = true;

                        jQuery('.dialogueBox').css('z-index','99');

                        // Listen for keydown events to dismiss active dialogue box
                        KeyDismissal = false;

                        setTimeout(function(){ // allow time for dialogue box to display

                            if(allowKeyDismissal) {
                                KeyDismissal = true;
                                keyDialogueBoxDismissal();
                            }

                        },500);

                    }

                }

            }

            // Minimize/Maximize Dialogue Box
            function toggleDockDialogueBox() {

                if (jQuery('.dialogueBox').hasClass('maximized-dialogueBox')) { // dock the dialogue box

                    jQuery('.dialogueBox').removeClass('maximized-dialogueBox').addClass('minimized-dialogueBox');
                    jQuery('.dialogueBox-maximize').show();
                    jQuery('.dialogueBox-minimize').hide();

                    // Current phase progression condition
                    switch (currentPhase) {
                        case 'confirmHandPhase' :
                            confirmHandPhase = false;
                            browseHandPhase = true;
                            currentPhase = 'browseHandPhase';

                            // Update phase indicator
                            updatePhaseIndicator();

                        break;
                        default:
                            currentPhase = '';
                    }

                } else if (jQuery('.dialogueBox').hasClass('minimized-dialogueBox')) { // undock the dialogue box

                    jQuery('.dialogueBox').removeClass('minimized-dialogueBox').addClass('maximized-dialogueBox');
                    jQuery('.dialogueBox-minimize').show();
                    jQuery('.dialogueBox-maximize').hide();

                    // Current phase progression condition
                    switch (currentPhase) {
                        case 'browseHandPhase' :
                            browseHandPhase = false;
                            confirmHandPhase = true;
                            currentPhase = 'confirmHandPhase';

                            // Update phase indicator
                            updatePhaseIndicator();

                        break;
                        case 'previewSelectionPhase' :
                            previewSelectionPhase = false;
                            confirmHandPhase = true;
                            currentPhase = 'confirmHandPhase';

                            // Dismiss preview pane
                            if(jQuery(previewPane).hasClass('inView')) {
                                jQuery(previewPane).removeClass('inView');
                            }

                            // Update phase indicator
                            updatePhaseIndicator();

                        break;
                        default:
                            currentPhase = '';
                    }

                }

            }

            // toggle dock with mouse
            jQuery('.wrapper').on('click', '.dialogueBox-minimize, .dialogueBox-maximize', function(){

                toggleDockDialogueBox();

            });

            // dismiss with keys
            function keyDialogueBoxDismissal() {

                jQuery(document).on('keydown',function(e) {

                    if (activeDialogueBox && KeyDismissal) {

                        dialogueBoxContent = null; // reset the dialogue box content storage variable

                        var key = e.key;

                        switch(key) {

                            case 'Escape':
                                toggleDialogueBox(false,false);
                            break;

                            case 'Enter':
                                toggleDialogueBox(false,false);
                            break;

                        }
                        
                        KeyDismissal = false; // disable dialogue box key dismissal

                    }

                });

            }

            // dismiss with mouse
            jQuery('.wrapper').on('click', '.dialogueBox-backdrop, .dialogueBox-dismiss', function(){

                if(currentPhase == 'confirmHandPhase') {

                    // end hand confirmation phase, proceed to next phase (caster select phase or resource pool phase)
                    toggleDialogueBox(false,false);

                    confirmHandPhase = false; // end hand confirmation phase

                    // determine if caster needs to be selected or is already present
                    let casterInPlay = jQuery('.in-play').find('.activeCaster').length;

                    if(casterInPlay == 0) { // no caster in play

                        casterSelectionPhase = true; // start caster selection phase and allow UI key navigation
                        currentPhase = 'casterSelectionPhase';

                        // Update phase indicator
                        updatePhaseIndicator();

                        // Update and display phase guide
                        guideInstruction = 'Place a valid caster card in play';
                        updatePhaseGuide(guideInstruction,currentPhase);

                        // Unmark valid selection options
                        unmarkValidSelections();

                        // Mark valid selection options
                        markValidSelections('caster-card-type');

                        // TODO : nerf ranking higher than neophyte (proficient 1/2, adept 1/3, elite 1/4, peerless 1/5)

                    } else {

                        resourcePoolPhase = true; // start resource pooling phase and allow UI key navigation
                        currentPhase = 'resourcePoolPhase';

                        // Update phase indicator
                        updatePhaseIndicator();

                        // Update and display phase guide
                        guideInstruction = 'Allocate a valid caster card for resource pooling';
                        updatePhaseGuide(guideInstruction,currentPhase);

                        // Unmark valid selection options
                        unmarkValidSelections();

                        // Mark valid selection options
                        markValidSelections('caster-card-type');

                        // Display resource value tags
                        displayResourceValueTags();

                    }

                } else if(currentPhase == 'confirmCasterPhase') { 

                    toggleDialogueBox(false,false);

                    confirmCasterPhase = false; // disallow UI key navigation
                    resourcePoolPhase = true; // start resource pooling phase and allow UI key navigation
                    currentPhase = 'resourcePoolPhase';

                    // Update phase indicator
                    updatePhaseIndicator();

                    // Update and display phase guide
                    guideInstruction = 'Allocate a valid caster card for resource pooling';
                    updatePhaseGuide(guideInstruction,currentPhase);

                    // Unmark valid selection options
                    unmarkValidSelections();

                    // Mark valid selection options
                    markValidSelections('caster-card-type');

                    // Display resource value tags
                    displayResourceValueTags();

                } else if(currentPhase == 'confirmResourcePhase') { 

                    toggleDialogueBox(false,false);

                    confirmResourcePhase = false; // disallow UI key navigation
                    /*resourcePoolPhase = true; // start resource pooling phase and allow UI key navigation
                    currentPhase = 'resourcePoolPhase';

                    // Update phase indicator
                    updatePhaseIndicator();

                    // Update and display phase guide
                    guideInstruction = 'Allocate a valid caster card for resource pooling';
                    updatePhaseGuide(guideInstruction,currentPhase);

                    // Unmark valid selection options
                    unmarkValidSelections();

                    // Mark valid selection options
                    markValidSelections('caster-card-type');*/

                } else {
                    toggleDialogueBox(false,false);
                }

            });

            // Confirm with mouse
            jQuery('.dialogueBox').on('click','.btn-confirm',function(){

                if(confirmHandPhase) {

                    var handPermanence = jQuery(this).attr('data-confirm');

                    determineHandConfirmation(playerHand,handPermanence); // handle confirmation response

                } else if(confirmCasterPhase) {

                    var confirmCaster = jQuery(this).attr('data-confirm');

                    determineCasterConfirmation(confirmCaster);

                } else if(confirmResourcePhase) {

                    var confirmResource = jQuery(this).attr('data-confirm');

                    determineResourceConfirmation(confirmResource);

                }

            });
            jQuery('.dialogueBox').on('mouseover','.btn-confirm',function() {

                jQuery('.btn-confirm').removeClass('focus');
                jQuery(this).addClass('focus');

            });

            // Confirm with keys
            function keyConfirmation() {

                if(confirmHandPhase) {

                    var handPermanence = jQuery('.btn-confirm.focus').attr('data-confirm');

                    determineHandConfirmation(playerHand,handPermanence); // handle confirmation response

                } else if(confirmCasterPhase) {

                    var confirmCaster = jQuery('.btn-confirm.focus').attr('data-confirm');

                    determineCasterConfirmation(confirmCaster);

                } else if(confirmResourcePhase) {

                    var confirmResource = jQuery('.btn-confirm.focus').attr('data-confirm');

                    determineResourceConfirmation(confirmResource);

                }

            }

            /*
            **
            ** Building Decks
            **
            */
            // An ES6 / ECMAScript 2015 shuffling function based on the Durstenfeld shuffle
            // https://stackoverflow.com/questions/2450954/how-to-randomize-shuffle-a-javascript-array
            function shuffleDeck(deckArray) {

                for (let i = deckArray.length - 1; i > 0; i--) {

                    const j = Math.floor(Math.random() * (i + 1));
                    [deckArray[i], deckArray[j]] = [deckArray[j], deckArray[i]]; // eslint-disable-line no-param-reassign

                }
                //console.log(deckArray);

            }

            // Assign and generate deck
            var useStandbyDeck = true,
                player_standbyDeck,
                player_deckName;
            if (useStandbyDeck) {
                player_standbyDeck = [...Array(60).keys()]; // build array consisting of 60 unit values
                player_deckName = 'Auto-generated Deck';
            }
            shuffleDeck(player_standbyDeck);
            console.log(player_standbyDeck);

            // Set deck name
            jQuery('.overview-deck-details').text(player_deckName);

            /*
            **
            ** Deck Management
            **
            */
            // check if any cards remain in standby deck
            // Returns: Boolean
            function checkForRemainingCardsInDeck(playerHand,deck) {

                if(typeof deck != "undefined" && deck != null && deck.length != null && deck.length > 0) {
                    return true;
                } else {
                    // empty standby deck
                    console.log('no remaining cards in deck');
                    jQuery(playerHand).find('.standby-pile').children().remove(); // remove any lingering standby card templates
                    return false;
                }

            }

            // Randomly generate the base power
            function generateCardPower() {

                // Generate a random number bewteen 25 and 100
                var cardForce = Math.floor(Math.random()*(100-25+1)+25);

                if(cardForce > 70 && cardForce < 80) {
                    //console.log(cardForce);
                    for (let i = 0; i < 3; i++) {
                        cardForce = Math.floor(Math.random()*(100-25+1)+25);
                        //console.log('adjusted',cardForce);
                        if (cardForce < 70) {
                            i = 3;
                        }
                    }
                } else if(cardForce > 80 && cardForce < 90) {
                    //console.log(cardForce);
                    for (let i = 0; i < 5; i++) {
                        cardForce = Math.floor(Math.random()*(100-25+1)+25);
                        //console.log('adjusted',cardForce);
                        if (cardForce < 80) {
                            i = 5;
                        }
                    }
                } else if(cardForce > 90) {
                    //console.log(cardForce);
                    for (let i = 0; i < 10; i++) {
                        cardForce = Math.floor(Math.random()*(100-25+1)+25);
                        //console.log('adjusted',cardForce);
                        if (cardForce < 90) {
                            i = 10;
                        }
                    }
                }

                return cardForce;

            }

            // Randomly generate card type
            function generateCardType() {

                // Generate a random number between 1 and 10
                var cardType = Math.floor(Math.random()*(10+1)); // 1 -> 9 = caster card, 10 = support card

                if(cardType == 10) {
                    //console.log(cardType);
                    //console.log('Support Card');
                } else {
                    //console.log(cardType);
                    //console.log('Caster Card');
                }

                return cardType;

            }

            // Randomly generate card support effect
            function generateCardSupport() {

                var supportBuff  = Math.floor(Math.random()*(10-1+1)+1), // 1 -> 5 = health boost, 6 -> 10 = attack boost
                    supportNerf  = Math.floor(Math.random()*(10-1+1)+1), // 1 -> 5 = health nerf, 6 -> 10 = attack nerf
                    supportType  = Math.floor(Math.random()*(20-1+1)+1), // 1 -> 5 = buff type, 6 -> 10 = nerf type, 11 -> 15 = battle effect type, 16 -> 20 = strategic effect type
                    supportBuild = 'placeholder',
                    supportDesc,
                    supportEfficacy;

                 // TEMP : To be detemined by specific card   
                 supportEfficacy = Math.floor(Math.random()*(100-25+1)+25); // 25 -> 69 = neophyte, 70 -> 79 = proficient, 80 -> 89 = adept, 90 -> 99 = elite, 100 = peerless

                if(supportType > 0 && supportType <= 5) { // Buff type support

                    if(supportBuff > 0 && supportBuff <= 5) {

                        supportDesc = "Reduce opponent's attack power by 10"; 
                        supportType = "Buff";

                        supportBuild = `<div class="card-support-motiv support-buff-effect">
                                            <i class="fas fa-shield-alt"></i>
                                            <i class="fas fa-angle-double-up"></i>
                                        </div>
                                        <div class="support-description">
                                            ${supportDesc}
                                        </div>
                                    <div class="support-efficacy">${supportEfficacy}</div>
                                    <div class="support-type">${supportType}</div>`;            

                    } else if(supportBuff > 5 && supportBuff <= 10) {   

                        supportDesc = "Boost own attack power by 10"; 
                        supportType = "Buff";

                        supportBuild = `<div class="card-support-motiv support-buff-effect">
                                            <i class="fas fa-crosshairs"></i>
                                            <i class="fas fa-angle-double-up"></i>
                                        </div>
                                        <div class="support-description">
                                            ${supportDesc}
                                        </div>
                                    <div class="support-efficacy">${supportEfficacy}</div>
                                    <div class="support-type">${supportType}</div>`;       

                    }


                } else if(supportType > 5 && supportType <= 10) { // Nerf type support

                    if(supportNerf > 0 && supportNerf <= 5) {

                        supportDesc = "Boost own attack power by 10"; 
                        supportType = "Nerf";

                        supportBuild = `<div class="card-support-motiv support-nerf-effect">
                                            <i class="fas fa-shield-alt"></i>
                                            <i class="fas fa-angle-double-down"></i>
                                        </div>
                                        <div class="support-description">
                                            ${supportDesc}
                                        </div>
                                    <div class="support-efficacy">${supportEfficacy}</div>
                                    <div class="support-type">${supportType}</div>`;            

                    } else if(supportNerf > 5 && supportNerf <= 10) {

                        supportDesc = "Reduce opponent's attack power by 10"; 
                        supportType = "Nerf";

                        supportBuild = `<div class="card-support-motiv support-nerf-effect">
                                            <i class="fas fa-crosshairs"></i>
                                            <i class="fas fa-angle-double-down"></i>
                                        </div>
                                        <div class="support-description">
                                            ${supportDesc}
                                        </div>
                                    <div class="support-efficacy">${supportEfficacy}</div>
                                    <div class="support-type">${supportType}</div>`;             

                    }


                } else if(supportType > 10 && supportType <= 15) { // Battle effect type support

                    supportDesc = "This is a battle effect type support card <br>Hydro: Freeze (paralysis), <br>Terra: Toxic (poisoning), <br>Pyro: Scorch (burning), <br>Aero: Shock (paralysis)"; 
                    supportType = "Battle";

                    supportBuild = `<div class="card-support-motiv support-battle-effect">
                                        <i class="far fa-hand-rock"></i>
                                    </div>
                                    <div class="support-description">
                                        ${supportDesc}
                                    </div>
                                    <div class="support-efficacy">${supportEfficacy}</div>
                                    <div class="support-type">${supportType}</div>`;


                } else if(supportType > 15 && supportType <= 20) { // Strategic effect type support

                    supportDesc = "This is a strategy effect type support card <br>Hydro: Tidal Force (Flush Deck), <br>Terra: Tectonic Shift (Bury Support), <br>Pyro: Scorched Earth (Burn Resources), <br>Aero: Gale Force (Sweep Away Hand)";
                    supportType = "Strategic";

                    supportBuild = `<div class="card-support-motiv support-strategic-effect">
                                        <i class="far fa-hand-paper"></i>
                                    </div>
                                    <div class="support-description">
                                        ${supportDesc}
                                    </div>
                                    <div class="support-efficacy">${supportEfficacy}</div>
                                    <div class="support-type">${supportType}</div>`;   

                }

                return supportBuild;

            }

            // Reveal card and assign rank determined by base power
            function revealDrawnCard(drawnCard, clonedCard, cardData) {

                setTimeout(function(){

                    jQuery(drawnCard).addClass('flippedCard'); // flip the modified card in the standby deck

                    setTimeout(function(){

                    jQuery(drawnCard).add(clonedCard).find('.cardBack').remove(); // remove the back
                    jQuery(drawnCard).remove(); // remove the modified card in the standby deck

                        if (useStandbyDeck) {

                            // Determine card type
                            let cardType = generateCardType();

                            if(cardType <= 9) { // caster type card

                                // Build card and define attributes
                                let elArray         = ['terra','aero','hydro','pyro'],
                                    cardDiscipline  = elArray[Math.floor(Math.random() * elArray.length)], // retrieve random value from array
                                    cardForce       = generateCardPower(),
                                    cardType        = 'Caster',
                                    cardBody        =   `<div class="cardFront">
                                                            <div class="card-marker">Valid</div>
                                                            <div class="card-number">${cardData}</div>
                                                            <div class="card-discipline">${cardDiscipline}</div>
                                                            <div class="card-resource-currency"></div>
                                                            <div class="card-elemental-motif"></div>
                                                            <div class="card-force-indicator">
                                                                <svg viewBox="0 0 32 32">
                                                                  <circle r="16" cx="16" cy="16" style="stroke-dasharray: ${cardForce} 100;"></circle>
                                                                </svg>
                                                                <div class="elite-force-indicator"></div>
                                                                <div class="adept-force-indicator"></div>
                                                                <div class="proficient-force-indicator"></div>
                                                            </div>
                                                            <div class="card-force">${cardForce}</div>
                                                            <div class="card-type">${cardType}</div>
                                                            <div class="card-ranking"></div>
                                                        </div>`;
                                jQuery(clonedCard).prepend(cardBody).removeClass('ghostCard');

                                // Define card type
                                jQuery(clonedCard).find('.cardFront').addClass('caster-card-type');

                                // Determine card ranking
                                if(cardForce == 100) {

                                    jQuery(clonedCard).find('.cardFront').addClass('peerless-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>');

                                    // Update Resource Currency
                                    jQuery(clonedCard).attr('data-resource-currency','0');

                                } else if(cardForce >= 90 && cardForce != 100) {

                                    jQuery(clonedCard).find('.cardFront').addClass('elite-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>');

                                    // Update Resource Currency
                                    jQuery(clonedCard).attr('data-resource-currency','1');
                                    jQuery(clonedCard).find('.card-resource-currency').prepend('<i class="fas fa-circle"></i>');

                                } else if(cardForce >= 80 && cardForce < 90) {

                                    jQuery(clonedCard).find('.cardFront').addClass('adept-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="fas fa-star"></i><i class="fas fa-star"></i>');

                                    // Update Resource Currency
                                    jQuery(clonedCard).attr('data-resource-currency','2');
                                    jQuery(clonedCard).find('.card-resource-currency').prepend('<i class="fas fa-circle"></i><i class="fas fa-circle"></i>');

                                } else if(cardForce >= 70 && cardForce < 80) {

                                    jQuery(clonedCard).find('.cardFront').addClass('proficient-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="fas fa-star"></i>');

                                    // Update Resource Currency
                                    jQuery(clonedCard).attr('data-resource-currency','3');
                                    jQuery(clonedCard).find('.card-resource-currency').prepend('<i class="fas fa-circle"></i><i class="fas fa-circle"></i><i class="fas fa-circle"></i>');

                                } else if(cardForce >= 25 && cardForce < 70) {

                                    jQuery(clonedCard).find('.cardFront').addClass('neophyte-ranking');

                                    // Update Resource Currency
                                    if(cardForce >= 45 && cardForce < 70) {

                                        jQuery(clonedCard).attr('data-resource-currency','4');
                                        jQuery(clonedCard).find('.card-resource-currency').prepend('<i class="fas fa-circle"></i><i class="fas fa-circle"></i><i class="fas fa-circle"></i><i class="fas fa-circle"></i>');

                                    } else if(cardForce >= 25 && cardForce < 45) {

                                        jQuery(clonedCard).attr('data-resource-currency','5');
                                        jQuery(clonedCard).find('.card-resource-currency').prepend('<i class="fas fa-circle"></i><i class="fas fa-circle"></i><i class="fas fa-circle"></i><i class="fas fa-circle"></i><i class="fas fa-circle"></i>');

                                    }

                                }

                                // Determine discipline type
                                if(cardDiscipline == 'terra') {

                                    jQuery(clonedCard).find('.cardFront').addClass('terra-motiv');
                                    jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-leaf"></i>');

                                } else if(cardDiscipline == 'aero') {

                                    jQuery(clonedCard).find('.cardFront').addClass('aero-motiv');
                                    jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-cloud"></i>');

                                } else if(cardDiscipline == 'hydro') {

                                    jQuery(clonedCard).find('.cardFront').addClass('hydro-motiv');
                                    jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-tint"></i>');

                                } else if(cardDiscipline == 'pyro') {

                                    jQuery(clonedCard).find('.cardFront').addClass('pyro-motiv');
                                    jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-burn"></i>');

                                }

                            } else if(cardType == 10) { // support type card

                                // Build card and define attributes
                                let elArray         = ['terra','aero','hydro','pyro'],
                                    cardDiscipline  = elArray[Math.floor(Math.random() * elArray.length)], // retrieve random value from array
                                    cardSupport     = generateCardSupport(),
                                    cardType        = 'Support',
                                    cardBody        =   `<div class="cardFront">
                                                            <div class="card-number">${cardData}</div>
                                                            <div class="card-discipline"></div>
                                                            <div class="card-elemental-motif"></div>
                                                            <div class="card-support">${cardSupport}</div>
                                                            <div class="card-type">${cardType}</div>
                                                            <div class="card-ranking"></div>
                                                            <div class="card-resource-cost"></div>
                                                        </div>`,
                                    cardEfficacy,
                                    cardSupportType;

                                jQuery(clonedCard).prepend(cardBody).removeClass('ghostCard');

                                // Further define card attributes
                                cardEfficacy    = jQuery(cardBody).find('.support-efficacy').text(),
                                cardSupportType = jQuery(cardBody).find('.support-type').text();

                                // Define card type
                                jQuery(clonedCard).find('.cardFront').addClass('support-card-type');

                                // Determine card efficacy
                                if(cardEfficacy == 100) {

                                    jQuery(clonedCard).find('.cardFront').addClass('peerless-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>');
                                    // TEMP : To be detemined by specific card
                                    jQuery(clonedCard).find('.card-resource-cost').prepend(
                                            `<div class="resource-cost" data-resource-cost="5">
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                            </div>`
                                        );

                                } else if(cardEfficacy >= 90 && cardEfficacy != 100) {

                                    jQuery(clonedCard).find('.cardFront').addClass('elite-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>');
                                    // TEMP : To be detemined by specific card
                                    jQuery(clonedCard).find('.card-resource-cost').prepend(
                                            `<div class="resource-cost" data-resource-cost="4">
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                            </div>`
                                        );

                                } else if(cardEfficacy >= 80 && cardEfficacy < 90) {

                                    jQuery(clonedCard).find('.cardFront').addClass('adept-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="fas fa-star"></i><i class="fas fa-star"></i>');
                                    // TEMP : To be detemined by specific card
                                    jQuery(clonedCard).find('.card-resource-cost').prepend(
                                            `<div class="resource-cost" data-resource-cost="3">
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                            </div>`
                                        );

                                } else if(cardEfficacy >= 70 && cardEfficacy < 80) {

                                    jQuery(clonedCard).find('.cardFront').addClass('proficient-ranking');
                                    jQuery(clonedCard).find('.card-ranking').prepend('<i class="fas fa-star"></i>');
                                    // TEMP : To be detemined by specific card
                                    jQuery(clonedCard).find('.card-resource-cost').prepend(
                                            `<div class="resource-cost" data-resource-cost="2">
                                                <i class="fas fa-circle"></i>
                                                <i class="fas fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                            </div>`
                                        );

                                } else if(cardEfficacy >= 15 && cardEfficacy < 70) {

                                    jQuery(clonedCard).find('.cardFront').addClass('neophyte-ranking');
                                    // TEMP : To be detemined by specific card
                                    jQuery(clonedCard).find('.card-resource-cost').prepend(
                                            `<div class="resource-cost" data-resource-cost="1">
                                                <i class="fas fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                                <i class="far fa-circle"></i>
                                            </div>`
                                        );

                                }

                                // Determine support card type
                                if(cardSupportType == 'Battle' || cardSupportType == 'Strategic') { // apply disciplines to strategic or battle type support cards

                                    // Determine discipline type
                                    if(cardDiscipline == 'terra') {

                                        jQuery(clonedCard).find('.cardFront').addClass('terra-motiv');
                                        jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-leaf"></i>');
                                        jQuery(clonedCard).find('.card-discipline').prepend(cardDiscipline);

                                    } else if(cardDiscipline == 'aero') {

                                        jQuery(clonedCard).find('.cardFront').addClass('aero-motiv');
                                        jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-cloud"></i>');
                                        jQuery(clonedCard).find('.card-discipline').prepend(cardDiscipline);

                                    } else if(cardDiscipline == 'hydro') {

                                        jQuery(clonedCard).find('.cardFront').addClass('hydro-motiv');
                                        jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-tint"></i>');
                                        jQuery(clonedCard).find('.card-discipline').prepend(cardDiscipline);

                                    } else if(cardDiscipline == 'pyro') {

                                        jQuery(clonedCard).find('.cardFront').addClass('pyro-motiv');
                                        jQuery(clonedCard).find('.card-elemental-motif').prepend('<i class="fas fa-burn"></i>');
                                        jQuery(clonedCard).find('.card-discipline').prepend(cardDiscipline);

                                    }

                                }

                            }

                        }

                    }, 250);

                }, 500);

            }

            /*
            **
            ** Draw Phase
            **
            */
            var playerHand, // prepare reference variable
                cardsInStandbyDeck;

            function beginDrawPhase() {

                if (drawPhase) {

                    if(playerTurn) {

                        // player start
                        playerHand = jQuery('[data-field="player-field"]');
                        drawCards(playerHand);

                        // Update and display phase guide
                        guideInstruction = 'Accept, rejcet or browse hand drawn.';
                        updatePhaseGuide(guideInstruction,currentPhase);

                    } else if(!playerTurn) {

                        // AI turn
                        playerHand = jQuery('[data-field="ai-field"]');
                        drawCards(playerHand);

                        // Dsimiss phase guide
                        dismissPhaseGuide();

                    }

                }

            }

            // Notify of invalid draw then redraw
            function invalidDraw(playerHand) {

                invalidDrawNotice = true; // allow key selection

                dialogueBoxContent =    `<div class="invalid-draw-notice">
                                            Invalid Draw
                                            <div class="invalid-draw-notice-detail">
                                                No valid caster cards detected.
                                            </div>
                                        </div>`;

                if(jQuery('.dialogueBox .dialogueBox-body').children().length === 0) { // prevent additional prepending by excessive user input
                    jQuery('.dialogueBox .dialogueBox-body').prepend(dialogueBoxContent);
                }

                // call dialogue box
                toggleDialogueBox(false,true);

                setTimeout(function(){ // auto dismiss after delay

                    // is the turn selection phase still active?
                    if (invalidDrawNotice) {

                        toggleDialogueBox(false,false);

                        discardCards(playerHand);

                    }

                },2000);

            }

            // Dismiss invalid Draw Notice
            function dismissInvalidDrawNotice() {

                invalidDrawNotice = false;

                discardCards(playerHand);

            }

            // Confirm or discard hand
            function handConfirmation(playerHand) {

                dialogueBoxContent =    `<div class="confirm-hand">
                                            Confirm Draw
                                            <div class="confirm-options">
                                                <div class="btn btn-confirm focus" data-confirm="true">Accept Hand</div>
                                                <div class="btn btn-confirm" data-confirm="false">Discard Hand</div>
                                                <div class="btn btn-confirm" data-confirm="deferred">Browse Hand</div>
                                            </div>
                                        </div>`;

                if(jQuery('.dialogueBox .dialogueBox-body').children().length === 0) { // prevent additional prepending by excessive user input
                    jQuery('.dialogueBox .dialogueBox-body').prepend(dialogueBoxContent);
                }

                // call dialogue box
                toggleDialogueBox(true,false);

                confirmHandPhase = true; // allow key selection
                currentPhase = 'confirmHandPhase';

                // Update phase indicator
                updatePhaseIndicator();

            }

            // Determine player confirmation
            function determineHandConfirmation(playerHand,handPermanence) {

                // continue based on condition returned
                if(handPermanence == 'true') { // player accepts hand

                    // end hand confirmation phase, proceed to next phase (caster select phase or resource pool phase)
                    toggleDialogueBox(false,false);

                    confirmHandPhase = false; // end hand confirmation phase

                    // determine if caster needs to be selected or is already present
                    let casterInPlay = jQuery('.in-play').find('.activeCaster').length;

                    if(casterInPlay == 0) { // no caster in play
                        casterSelectionPhase = true; // start caster selection phase and allow UI key navigation
                        currentPhase = 'casterSelectionPhase';

                        // Update phase indicator
                        updatePhaseIndicator();

                        // Update and display phase guide
                        guideInstruction = 'Place a valid caster card in play';
                        updatePhaseGuide(guideInstruction,currentPhase);

                        // Unmark valid selection options
                        unmarkValidSelections();

                        // Mark valid selection options
                        markValidSelections('caster-card-type');

                    } else {
                        resourcePoolPhase = true; // start resource pooling phase and allow UI key navigation
                        currentPhase = 'resourcePoolPhase';

                        // Update phase indicator
                        updatePhaseIndicator();

                        // Update and display phase guide
                        guideInstruction = 'Allocate a valid caster card for resource pooling';
                        updatePhaseGuide(guideInstruction,currentPhase);

                        // Unmark valid selection options
                        unmarkValidSelections();

                        // Mark valid selection options
                        markValidSelections('caster-card-type');

                        // Display resource value tags
                        displayResourceValueTags();

                    }

                } else if(handPermanence == 'false') { // player rejects hand

                    toggleDialogueBox(false,false); // dismiss the dialogue box

                    confirmHandPhase = false; // end hand confirmation phase

                    // discard current hand
                    discardCards(playerHand);

                } else if(handPermanence == 'deferred') { // player browses hand

                    // minimize dialogue box
                    toggleDockDialogueBox();

                }

            }

            // discard hand
            function discardCards(playerHand) {

                iterationDelay = 200;

                // get co-ordinates and dimensions of the dead pile
                var deadPile = jQuery(playerHand).find('.dead-pile');
                    deadPileOffset = jQuery(deadPile).offset(),
                    deadPileTop = deadPileOffset.top,
                    deadPileLeft = deadPileOffset.left,
                    deadPileWidth = jQuery(deadPile).outerHeight(),
                    deadPileHeight = jQuery(deadPile).outerWidth();

                // draw x6 cards
                jQuery(playerHand).find('.card-aperture.closed').each(function(i){

                    let current_aperture = jQuery(this);

                    setTimeout(function(){

                        if(jQuery(current_aperture).hasClass('closed')){

                            let current_discardingCard = jQuery(current_aperture).find('.card'), // store to variable
                                current_clonedCard;

                            // Open card slot
                            jQuery(current_aperture).removeClass('closed').addClass('open');

                            // Epheremal state handler
                            jQuery(current_aperture).addClass('placingCard');

                            // Retrieve co-ordinates and dimensions of card aperture
                            var cardApertureOffset = jQuery(current_aperture).offset(),
                                cardApertureTop = cardApertureOffset.top,
                                cardApertureLeft = cardApertureOffset.left;

                            // Set relative co-ordinates
                            var relativeTop = deadPileTop - cardApertureTop,
                                relativeLeft = deadPileLeft - cardApertureLeft;

                            // Discarding card
                            jQuery(current_discardingCard).addClass('idleCard scaleSmall speedX2').removeClass('activeCard');
                            jQuery(current_discardingCard).removeClass(function (index, className) { // remove the clone iteration reference
                                return (className.match (/(^|\s)clone-iteration-\S+/g) || []).join(' ');
                            });
                            jQuery(current_discardingCard).css({'top':relativeTop,'left':relativeLeft,'width':deadPileWidth,'height':deadPileHeight}); // in motion
                            jQuery(current_discardingCard).clone().appendTo(deadPile).removeClass('speedX2').addClass('ghostCard discard-iteration-'+i); // clone the modifeid card and add to dead pile
                            current_clonedCard = jQuery('.discard-iteration-'+i);

                            setTimeout(function(){

                                jQuery(current_discardingCard).remove();
                                jQuery(current_clonedCard).css({'top':'0','left':'0'}); // lock in position
                                jQuery(current_clonedCard).removeClass('ghostCard');
                                jQuery(current_aperture).removeClass('placingCard');

                            }, 200);

                            // Redraw if hand is cleared
                            remainingIterations = jQuery(playerHand).find('.card-aperture.closed').length;

                            if(remainingIterations <= 0) { // allow delay for final card to clear hand

                                setTimeout(function(){ // ...then draw new hand

                                    cardsInStandbyDeck = checkForRemainingCardsInDeck(playerHand,player_standbyDeck);

                                    if(cardsInStandbyDeck) {

                                        // draw a new hand
                                        drawCards(playerHand);

                                    } else { 
                                        // empty standby deck
                                        console.log('no cards detected in standby deck'); 
                                    }

                                }, 500);

                            }

                        }

                    }, iterationDelay);

                    iterationDelay += 200;

                });

            }

            // draw hand
            function drawCards(playerHand) {

                cardsInStandbyDeck = checkForRemainingCardsInDeck(playerHand,player_standbyDeck);;

                var idleCard = '<div class="card idleCard">'+cardBack+'</div>',
                    stackCount = player_standbyDeck.length;

                if(cardsInStandbyDeck) {

                    if(jQuery(playerHand).find('.standby-pile .idleCard').length <= 0) {
                        jQuery(playerHand).find('.standby-pile').prepend(idleCard);
                    }

                    // Set stack counter
                    jQuery(playerHand).find('.stack-counter span').text(stackCount);

                    var cardsInStandbyDeckCard_offset = jQuery(playerHand).find('.standby-pile .card').offset(),
                        cardsInStandbyDeckCard_top = cardsInStandbyDeckCard_offset.top,
                        cardsInStandbyDeckCard_left = cardsInStandbyDeckCard_offset.left,
                        cardsInStandbyDeckCard_width = jQuery(playerHand).find('.standby-pile .card').outerWidth(),
                        cardsInStandbyDeckCard_height = jQuery(playerHand).find('.standby-pile .card').outerHeight();

                    jQuery(playerHand).find('.standby-pile .card').css('position','absolute');

                    iterationDelay = 200;
                    
                    // Retrieve co-ordinates and dimensions of card aperture
                    var cardApertureOffset,
                        cardApertureTop,
                        cardApertureLeft,
                        cardApertureWidth,
                        cardApertureHeight;

                    // Draw cards
                    jQuery(playerHand).find('.card-aperture.open').each(function(i){

                        let current_aperture = jQuery(this);

                        setTimeout(function(){

                            if(jQuery(current_aperture).hasClass('open')) {

                                // Retrieve co-ordinates and dimensions of open card aperture
                                cardApertureOffset = jQuery(current_aperture).offset();
                                cardApertureTop = cardApertureOffset.top;
                                cardApertureLeft = cardApertureOffset.left;
                                cardApertureWidth = jQuery(current_aperture).outerWidth();
                                cardApertureHeight = jQuery(current_aperture).outerHeight();

                                // Set relative co-ordinates
                                var relativeTop = cardsInStandbyDeckCard_top - cardApertureTop,
                                    relativeLeft = cardsInStandbyDeckCard_left - cardApertureLeft;

                                // Check for remaining cards in standby deck
                                if(cardsInStandbyDeck){

                                    // Draw the last card in the deck array
                                    let cardDetails = player_standbyDeck.pop(), // remove the last value from array (top card of standby deck)
                                        current_activeCard,
                                        current_clonedCard,
                                        playerActiveHand = jQuery(playerHand).find('.player-hand');

                                    // Draw Preparation
                                    jQuery(playerHand).find('.standby-pile .idleCard').clone().appendTo(playerActiveHand).addClass('drawing-iteration-'+i).attr('data-iteration',i); // assign active state to standby card

                                    current_activeCard = jQuery('.drawing-iteration-'+i); // store to variable

                                    jQuery(current_activeCard).css({'top': cardsInStandbyDeckCard_top, 
                                                                    'left': cardsInStandbyDeckCard_left, 
                                                                    'height': cardsInStandbyDeckCard_width,
                                                                    'width': cardsInStandbyDeckCard_height,
                                                                    'z-index': '9'
                                                                    }); // position standby card

                                    // Update stack counter
                                    stackCount = player_standbyDeck.length;
                                    jQuery(playerHand).find('.stack-counter span').text(stackCount);

                                    // Check remaining standby card count
                                    if(stackCount <= 10) {
                                        jQuery(playerHand).find('.stack-counter').addClass('stack-count-low');
                                    }

                                    // Drawing card
                                    setTimeout(function(){ // allow for a small delay for standby positioning to establish

                                        jQuery(current_activeCard).removeClass('idleCard').addClass('activeCard').css({ 'top': cardApertureTop,
                                                                                                                        'left': cardApertureLeft,
                                                                                                                        'width':cardApertureWidth,
                                                                                                                        'height':cardApertureHeight
                                                                                                                        }); // in motion
                                        jQuery(current_activeCard).clone().appendTo(current_aperture).removeClass('activeCard drawing-iteration-'+i).addClass('ghostCard clone-iteration-'+i); // clone the modifeid card and add to open aperture
                                        current_clonedCard = jQuery('.clone-iteration-'+i);
                                        jQuery(current_clonedCard).css({'top':'0','left':'0'}); // lock in position

                                        // Reveal drawn card
                                        revealDrawnCard(current_activeCard, current_clonedCard, cardDetails);

                                    },100);

                                    // Close card slot
                                    jQuery(current_aperture).removeClass('open').addClass('closed');

                                    // Check if it was the last card
                                    checkForRemainingCardsInDeck(playerHand,player_standbyDeck);

                                } else { 
                                    // Empty standby deck
                                    console.log('no cards detected in standby deck'); 
                                }

                            }

                            // Prompt hand confirmation
                            if(jQuery(playerHand).find('.card-aperture.open').length <= 0 && stackCount >= 1) {

                                setTimeout(function(){

                                    // Check for valid caster type cards
                                    if(jQuery(playerHand).find('.card-aperture .caster-card-type').length > 0) { // valid caster type found

                                        setTimeout(function(){

                                            drawPhase = false; // end draw phase

                                            // Confirm hand or discard all to draw again
                                            handConfirmation(playerHand);

                                        }, 200);

                                    // Validate hand after draw
                                    } else { // no valid caster type found

                                        setTimeout(function(){

                                            drawPhase = false; // end draw phase

                                            // Notify player beforing discarding hand and redrawing
                                            invalidDraw(playerHand);

                                        }, 200);

                                    }

                                }, 1000);                                

                            } else if(stackCount <= 1) {

                                setTimeout(function(){

                                    // Check for valid caster type cards
                                    if(jQuery(playerHand).find('.card-aperture .caster-card-type').length > 0) { // valid caster type found

                                        drawPhase = false; // end draw phase
                                        casterSelectionPhase = true; // start caster selection phase and allow UI key navigation
                                        currentPhase = 'casterSelectionPhase';

                                        // Update phase indicator
                                        updatePhaseIndicator();

                                        // Update and display phase guide
                                        guideInstruction = 'Place a valid caster card in play';
                                        updatePhaseGuide(guideInstruction,currentPhase);

                                        // Unmark valid selection options
                                        unmarkValidSelections();

                                        // Mark valid selection options
                                        markValidSelections('caster-card-type');

                                    // Validate hand after draw
                                    } else { // no valid caster type found

                                        // TODO : player loses game if no valid caster card is found and there are no more cards to draw
                                        console.log('game loss');

                                    }

                                }, 1000); 

                            }

                        }, iterationDelay);

                        iterationDelay += 200;

                    });

                } else {

                    jQuery(playerHand).find('.standby-pile').empty();

                }

            }

            /*
            **
            ** Turn Selection Phase
            **
            */
            // Start turn selection phase
            if (turnSelectPhase) {

                var elArray = ['terra','aero','hydro','pyro'],
                    elArrayDesignated = [],
                    autoSelection = elArray[Math.floor(Math.random() * elArray.length)], // retrieve random value from array
                    playerSelection,
                    selectedTurn,
                    playerTurn,
                    autoDesignation;

                turnSelect(elArray);

                // imitiate key navigation phase (will remain active and adjust behaviour according to given active states)
                keyNavigation(); 

            }

            // End turn selection phase
            function endTurnSelectPhase() {

                // Hide, then remove from DOM
                jQuery('.turnCard-component').fadeOut(function(){
                    jQuery('.turnCard-component').remove();
                });

                turnSelectPhase = false; // end turn phase
                drawPhase = true; // start draw phase 
                currentPhase = 'drawPhase';

                // Update phase indicator
                updatePhaseIndicator();

                beginDrawPhase();

            } 

            function turnSelect(elArray) {

                // Randomly selected turn matching card
                jQuery('<div></div>').addClass('turnCard turnCard-hidden').attr('data-element',autoSelection).appendTo('.turnCard-match');

                // Append the turn card back
                jQuery('.turnCard-match .turnCard').append('<div class="card facedownCard">'+cardBack+'</div>');

                switch(autoSelection) {

                    case 'terra':
                        jQuery('.turnCard .card').append('<div class="cardFront ghostCard"><div class="card"><i class="fas fa-leaf"></i></div></div>');
                    break;

                    case 'aero':
                        jQuery('.turnCard .card').append('<div class="cardFront ghostCard"><div class="card"><i class="fas fa-cloud"></i></div></div>');
                    break;

                    case 'hydro':
                        jQuery('.turnCard .card').append('<div class="cardFront ghostCard"><div class="card"><i class="fas fa-tint"></i></div></div>');
                    break;

                    case 'pyro':
                        jQuery('.turnCard .card').append('<div class="cardFront ghostCard"><div class="card"><i class="fas fa-burn"></i></div></div>');
                    break;

                }

                // Draw the turn card match
                setTimeout(function(){

                    jQuery('.turnCard-match .turnCard').removeClass('turnCard-hidden').addClass('turnCard-drawn');

                },300);

                // Randomly designate turn selection cards
                iterationDelay = 0;
                iterationCount = 0;
                for(var i=0; i <= 3; i++) {

                    autoDesignation = elArray[Math.floor(Math.random() * elArray.length)]
                    elArrayDesignated.push(autoDesignation);
                    elArray.splice( elArray.indexOf(autoDesignation), 1 );

                    // Build the turn card wrapper
                    jQuery('<div></div>').addClass('turnCard turnCard-hidden').attr({'data-element':autoDesignation,'data-designation':i}).prependTo('.turnCard-selection');

                    // Append the turn card back
                    jQuery('.turnCard[data-designation="'+i+'"]').append('<div class="card facedownCard">'+cardBack+'</div>');

                    switch(autoDesignation) {

                        case 'terra':
                            jQuery('.turnCard[data-designation="'+i+'"] .card').append('<div class="cardFront"><i class="fas fa-leaf"></i></div>');
                        break;

                        case 'aero':
                            jQuery('.turnCard[data-designation="'+i+'"] .card').append('<div class="cardFront"><i class="fas fa-cloud"></i</div>');
                        break;

                        case 'hydro':
                            jQuery('.turnCard[data-designation="'+i+'"] .card').append('<div class="cardFront"><i class="fas fa-tint"></i></div>');
                        break;

                        case 'pyro':
                            jQuery('.turnCard[data-designation="'+i+'"] .card').append('<div class="cardFront"><i class="fas fa-burn"></i></div>');
                        break;

                    }

                    jQuery('.turnCard[data-designation="'+i+'"] .cardFront').addClass('ghostCard');

                    // Draw and reveal turn card
                    iterationDelay += 300;
                    iterationCount += 1;
                    drawTurnCard(i, iterationDelay, iterationCount);

                }

            }

            // Draw turn card selection options
            function drawTurnCard(i, iterationDelay, iterationCount) {

                setTimeout(function(){

                    setTimeout(function(){

                        jQuery('.turnCard[data-designation="'+i+'"]').removeClass('turnCard-hidden').addClass('turnCard-drawn');

                        revealTurnCard(i);

                        if(iterationCount >= 4) { // allow delay for final card to reveal

                            setTimeout(function(){ // ...then apply to first card in set
                
                                if(!jQuery('.turnCard-selection .turnCard').hasClass('focus')) { // ...if this class doesn't alreaddy exist on a card

                                    jQuery('.turnCard-selection').find('.turnCard').first().addClass('focus');

                                }

                                // Update and display phase guide
                                guideInstruction = 'Choose a card. You draw first if it matches the face-down card';
                                updatePhaseGuide(guideInstruction,currentPhase);

                            }, 1000);

                        }

                    },300);

                }, iterationDelay);

            }

            // Reveal turn card selection options
            function revealTurnCard(i) {

                var drawnTurnCard = jQuery('.turnCard[data-designation="'+i+'"] .card');

                setTimeout(function(){

                    jQuery(drawnTurnCard).removeClass('facedownCard').addClass('flippedCard');

                    setTimeout(function(){

                        jQuery(drawnTurnCard).removeClass('flippedCard');
                        jQuery(drawnTurnCard).find('.cardFront').removeClass('ghostCard');
                        jQuery(drawnTurnCard).find('.cardBack').remove();

                    },150);

                },500);

            }

            // Select with mouse
            jQuery('.turnCard-component .turnCard-selection').on('click','.turnCard',function() {

                if(!jQuery(this).hasClass('focus')) {
                    jQuery('.turnCard').removeClass('focus');
                    jQuery(this).addClass('focus');
                }

                playerSelection = jQuery(this).attr('data-element');

                determineTurnOutcome();

            });
            jQuery('.turnCard-component .turnCard-selection').on('mouseover','.turnCard',function() {

                jQuery('.turnCard').removeClass('focus');
                jQuery(this).addClass('focus');

            });

            // Select with keys
            function keyTurnSelect(){

                playerSelection = jQuery('.turnCard.focus').attr('data-element');

                determineTurnOutcome();

            }

            // Is the player going first or is the AI going first?
            function determineTurnOutcome(){

                if(playerSelection == autoSelection) {
                    selectedTurn = 'first';
                    playerTurn = true;
                    // Set turn indicator
                    jQuery('[data-field="player-field"] .turn-indicator').addClass('activeTurn');
                } else {
                    selectedTurn = 'second';
                    playerTurn = false;
                    // Set turn indicator
                    jQuery('[data-field="ai-field"] .turn-indicator').addClass('activeTurn');
                }

                // determine player turn and generate dialogue box content
                if (playerTurn) {
                    dialogueBoxContent =    `<div class="turn-result">
                                                1<sup>st</sup> Turn
                                                <div class="turn-order">You draw first</div>
                                            </div>`;
                } else {
                    dialogueBoxContent =    `<div class="turn-result">
                                                2<sup>nd</sup> Turn
                                                <div class="turn-order">You draw second</div>
                                            </div>`;
                }
                if(jQuery('.dialogueBox .dialogueBox-body').children().length === 0) { // prevent additional prepending by excessive user input
                    jQuery('.dialogueBox .dialogueBox-body').prepend(dialogueBoxContent);
                }

                // Reveal turn card match
                setTimeout(function(){

                    var drawnTurnCardMatch = jQuery('.turnCard-match .turnCard');

                    jQuery(drawnTurnCardMatch).removeClass('facedownCard').addClass('flippedCard');

                    setTimeout(function(){

                        jQuery(drawnTurnCardMatch).removeClass('flippedCard');
                        jQuery(drawnTurnCardMatch).find('.cardFront').removeClass('ghostCard');
                        jQuery(drawnTurnCardMatch).find('.cardBack').remove();

                        setTimeout(function(){

                            // call dialogue box
                            toggleDialogueBox(false,true);

                            setTimeout(function(){ // auto dismiss after delay

                                // is the turn selection phase still active?
                                if (turnSelectPhase) {
                                    toggleDialogueBox(false,false);
                                }

                            },2000);

                        },300);

                    },150);

                },500);

            }

            /*
            **
            ** Selection Phases
            **
            */
            var casterSelection,
                resourceSelection,
                playerField,
                cardAperture;

            // Mark valid selections
            function markValidSelections(validType) {

                playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                jQuery('[data-field="'+playerField+'"] .card-aperture').each(function(){

                    if(jQuery(this).find('.cardFront').hasClass(validType)) {

                        jQuery(this).addClass('valid-for-selection');

                    } else {

                        jQuery(this).addClass('invalid-for-selection');

                    }

                });

            }

            // Unmark valid selections
            function unmarkValidSelections() {

                playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                jQuery('[data-field="'+playerField+'"] .card-aperture').each(function(){

                    jQuery(this).removeClass('valid-for-selection invalid-for-selection');

                });

            }

            // Select with mouse
            jQuery('.player-hand').on('click','.valid-for-selection',function() {

                if(casterSelectionPhase) {

                    if(!jQuery(this).hasClass('focus')) {
                        jQuery('.card-aperture').removeClass('focus');
                        jQuery(this).addClass('focus');
                    }

                    cardAperture = jQuery(this);
                    jQuery(cardAperture).find('.card').addClass('casterSelection');

                    casterSelection = jQuery('.casterSelection');
                    playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                    confirmCasterSelection(casterSelection, playerField, cardAperture);

                }

                if(resourcePoolPhase) {

                    if(!jQuery(this).hasClass('focus')) {
                        jQuery('.card-aperture').removeClass('focus');
                        jQuery(this).addClass('focus');
                    }

                    cardAperture = jQuery(this);
                    jQuery(cardAperture).find('.card').addClass('resourceSelection');

                    resourceSelection = jQuery('.resourceSelection');
                    playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                    confirmResourceSelection(resourceSelection, playerField, cardAperture);

                }

            });
            jQuery('.player-hand').on('mouseover','.card-aperture',function() {

                jQuery('.card-aperture').removeClass('focus');
                jQuery(this).addClass('focus');

            });

            /*
            **
            ** Caster Selection Phase
            **
            */

            // Select with keys
            function keySelectCaster() {

                if(casterSelectionPhase) {

                    cardAperture = jQuery('.valid-for-selection.focus');
                    jQuery(cardAperture).find('.card').addClass('casterSelection');

                    casterSelection = jQuery('.casterSelection');
                    playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                    confirmCasterSelection(casterSelection, playerField, cardAperture);

                }

            }

            // Prompt player to confirm selection
            function confirmCasterSelection(casterSelection, playerField, cardAperture) {

                // Move to in-play field
                placeInPlay(casterSelection, playerField, cardAperture);
                jQuery(cardAperture).removeClass('focus closed valid-for-selection').addClass('open');

                dialogueBoxContent =    `<div class="confirm-hand">
                                            Confirm Selection
                                            <div class="confirm-options">
                                                <div class="btn btn-confirm focus" data-confirm="true">Accept Caster</div>
                                                <div class="btn btn-confirm" data-confirm="false">Reject Caster</div>
                                            </div>
                                        </div>`;

                if(jQuery('.dialogueBox .dialogueBox-body').children().length === 0) { // prevent additional prepending by excessive user input
                    jQuery('.dialogueBox .dialogueBox-body').prepend(dialogueBoxContent);
                }

                // call dialogue box
                toggleDialogueBox(false,true);

                casterSelectionPhase = false; // disallow UI key navigation
                confirmCasterPhase = true; // allow key selection
                currentPhase = 'confirmCasterPhase';

                // Update phase indicator
                updatePhaseIndicator();

            }

            function HPcharge(charge) {

                playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                iterationDelay = 100;

                if(charge == 'up') {

                    jQuery(jQuery('[data-battle-field="'+playerField+'"] .hitpoint-meter div').get().reverse()).each(function(){
                    
                        let HPmeter = jQuery(this);

                        setTimeout(function(){

                            jQuery(HPmeter).addClass('activeIndicator');

                        }, iterationDelay);

                        iterationDelay += 100;

                    });

                } else if(charge == 'down') {

                    jQuery('[data-battle-field="'+playerField+'"] .hitpoint-meter div').each(function(){
                    
                        let HPmeter = jQuery(this);

                        setTimeout(function(){

                            jQuery(HPmeter).removeClass('activeIndicator');

                        }, iterationDelay);

                        iterationDelay += 50;

                    });

                }

            }

            // Determine caster confirmation
            function determineCasterConfirmation(confirmCaster) {

                // continue based on condition returned
                if(confirmCaster == 'true') { // player accepts hand

                    toggleDialogueBox(false,true);

                    jQuery('.card-aperture').removeClass('tetherCard'); // remove card tether reference

                    confirmCasterPhase = false; // disallow UI key navigation
                    resourcePoolPhase = true; // start resource pooling phase and allow UI key navigation
                    currentPhase = 'resourcePoolPhase';

                    // Update phase indicator
                    updatePhaseIndicator();

                    // Update and display phase guide
                    guideInstruction = 'Allocate a valid caster card for resource pooling';
                    updatePhaseGuide(guideInstruction,currentPhase);

                    // Unmark valid selection options
                    unmarkValidSelections();

                    // Mark valid selection options
                    markValidSelections('caster-card-type');

                    // Display resource value tags
                    displayResourceValueTags();

                } else if(confirmCaster == 'false') { // player rejects hand

                    toggleDialogueBox(false,true);

                    cardAperture = jQuery('.tetherCard');
                    casterSelection = jQuery('.in-play').find('.activeCaster');
                    playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                    removeFromPlay(casterSelection, playerField, cardAperture);

                    confirmCasterPhase = false; // disallow UI key navigation
                    casterSelectionPhase = true; // start caster selection phase and allow UI key navigation
                    currentPhase = 'casterSelectionPhase';

                    // Update phase indicator
                    updatePhaseIndicator();

                    // Update and display phase guide
                    guideInstruction = 'Place a valid caster card in play';
                    updatePhaseGuide(guideInstruction,currentPhase);

                    // Unmark valid selection options
                    unmarkValidSelections();

                    // Mark valid selection options
                    markValidSelections('caster-card-type');

                }

            }

            // Move seleted caster into field of play
            function placeInPlay(casterSelection, playerField, cardAperture) {

                // Epheremal state handler
                jQuery(cardAperture).addClass('placingCard');

                // Retrieve co-ordinates and dimensions of in-play placeholder
                var placeholder = jQuery('[data-battle-field="'+playerField+'"]').find('.in-play'),
                    placeholderOffset = jQuery(placeholder).offset(),
                    placeholderTop = placeholderOffset.top,
                    placeholderLeft = placeholderOffset.left,
                    placeholderWidth = jQuery(placeholder).outerWidth(),
                    placeholderHeight = jQuery(placeholder).outerHeight();

                // Retrieve co-ordinates and dimensions of card aperture
                var cardApertureOffset = jQuery(cardAperture).offset(),
                    cardApertureTop = cardApertureOffset.top,
                    cardApertureLeft = cardApertureOffset.left;

                // Set relative co-ordinates
                var relativeTop = placeholderTop - cardApertureTop,
                    relativeLeft = placeholderLeft - cardApertureLeft;

                // Placing card
                jQuery(casterSelection).addClass('activeCard speedX2');
                jQuery(casterSelection).css({'top':relativeTop,'left':relativeLeft,'width':placeholderWidth,'height':placeholderHeight}); // in motion
                jQuery(casterSelection).clone().appendTo(placeholder).removeClass('casterSelection activeCard speedX2').addClass('activeCaster ghostCard'); // clone the modifeid card and add to in-play placeholder

                setTimeout(function(){

                    jQuery(casterSelection).remove();
                    jQuery('.activeCaster').css({'top':'0','left':'0'}); // lock in position
                    jQuery('.activeCaster').removeClass('ghostCard');
                    jQuery(cardAperture).removeClass('placingCard');
                    jQuery(cardAperture).addClass('tetherCard'); // tether card to aperture for return reference if necessary

                }, 200);

                HPcharge('up');

            }

            // Remove seleted caster from field of play
            function removeFromPlay(casterSelection, playerField, cardAperture) {

                var inPlayAperture = jQuery('[data-battle-field="'+playerField+'"]').find('.in-play');

                // Epheremal state handler
                jQuery(inPlayAperture).addClass('placingCard');

                // Retrieve co-ordinates and dimensions of in-play placeholder
                var placeholder = jQuery('[data-battle-field="'+playerField+'"]').find('.in-play'),
                    placeholderOffset = jQuery(placeholder).offset(),
                    placeholderTop = placeholderOffset.top,
                    placeholderLeft = placeholderOffset.left;

                // Retrieve co-ordinates and dimensions of card aperture
                var cardApertureOffset = jQuery(cardAperture).offset(),
                    cardApertureTop = cardApertureOffset.top,
                    cardApertureLeft = cardApertureOffset.left
                    cardApertureWidth = jQuery(cardAperture).outerWidth(),
                    cardApertureHeight = jQuery(cardAperture).outerHeight();

                // Set relative co-ordinates
                var relativeTop = cardApertureTop - placeholderTop,
                    relativeLeft = cardApertureLeft - placeholderLeft;

                // Placing card
                jQuery(casterSelection).removeClass('activeCaster activeCard').addClass('speedX2');
                jQuery(casterSelection).css({'top':relativeTop,'left':relativeLeft,'width':cardApertureWidth,'height':cardApertureHeight}); // in motion
                jQuery(casterSelection).clone().appendTo(cardAperture).removeClass('speedX2').addClass('inactiveCaster ghostCard'); // clone the modifeid card and add to in-play placeholder

                setTimeout(function(){

                    jQuery(casterSelection).remove();
                    jQuery('.inactiveCaster').css({'top':'0','left':'0'}); // lock in position
                    jQuery('.inactiveCaster').removeClass('inactiveCaster ghostCard');
                    jQuery(cardAperture).removeClass('tetherCard open');
                    jQuery(inPlayAperture).removeClass('placingCard');
                    jQuery(cardAperture).addClass('closed valid-for-selection'); // restore former aperture classes

                }, 200);

                HPcharge('down');

            }

            /*
            **
            ** Resource Pool Phase
            **
            */
            var resourceMotiv,
                resourceCurrency,
                resourceCurrentCount,
                resourceUpdatedCount,
                resourceTagReference;

            // Select with keys
            function keySelectResource() {

                if(resourcePoolPhase) {

                    cardAperture = jQuery('.valid-for-selection.focus');
                    jQuery(cardAperture).find('.card').addClass('resourceSelection');

                    resourceSelection = jQuery('.resourceSelection');
                    playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                    confirmResourceSelection(resourceSelection, playerField, cardAperture);

                }

            }

            // Prompt player to confirm selection
            function confirmResourceSelection(resourceSelection, playerField, cardAperture) {

                // Move to resource pool
                placeInPool(resourceSelection, playerField, cardAperture);
                jQuery(cardAperture).removeClass('focus closed valid-for-selection').addClass('open');

                dialogueBoxContent =    `<div class="confirm-hand">
                                            Confirm Selection
                                            <div class="confirm-options">
                                                <div class="btn btn-confirm focus" data-confirm="true">Confirm</div>
                                                <div class="btn btn-confirm" data-confirm="false">Reject</div>
                                            </div>
                                        </div>`;

                if(jQuery('.dialogueBox .dialogueBox-body').children().length === 0) { // prevent additional prepending by excessive user input
                    jQuery('.dialogueBox .dialogueBox-body').prepend(dialogueBoxContent);
                }

                // call dialogue box
                toggleDialogueBox(false,true);

                resourcePoolPhase = false; // disallow UI key navigation
                confirmResourcePhase = true; // allow key selection
                currentPhase = 'confirmResourcePhase';

                // Update phase indicator
                updatePhaseIndicator();

            }

            // Determine resource confirmation
            function determineResourceConfirmation(confirmResource) {

                // continue based on condition returned
                if(confirmResource == 'true') { // player confirms resource

                    toggleDialogueBox(false,true);

                    jQuery('.card-aperture').removeClass('tetherCard'); // remove card tether reference
                    jQuery('.resource').removeClass('poolingResource'); // remove resource pool reference
                    jQuery('.resource-aperture').removeClass('activeResource'); // remove aperture reference

                    // Remove resource value tags
                    removeResourceValueTags();

                    confirmResourcePhase = false; // disallow UI key navigation
                    /*resourcePoolPhase = true; // start resource pooling phase and allow UI key navigation
                    currentPhase = 'resourcePoolPhase';

                    // Update phase indicator
                    updatePhaseIndicator();

                    // Update and display phase guide
                    guideInstruction = 'Allocate a valid caster card for resource pooling';
                    updatePhaseGuide(guideInstruction,currentPhase);

                    // Mark valid selection options
                    markValidSelections('caster-card-type');*/

                    // Unmark valid selection options
                    unmarkValidSelections();

                } else if(confirmResource == 'false') { // player rescinds resource

                    toggleDialogueBox(false,true);

                    cardAperture = jQuery('.tetherCard');
                    resourceSelection = jQuery('.resource').find('.activeResource');
                    playerField = jQuery('.activeTurn').closest('.field').attr('data-field');

                    removeFromPool(resourceSelection, playerField, cardAperture);

                    confirmResourcePhase = false; // disallow UI key navigation
                    resourcePoolPhase = true; // start resource pooling phase and allow UI key navigation
                    currentPhase = 'resourcePoolPhase';

                    // Update phase indicator
                    updatePhaseIndicator();

                    // Update and display phase guide
                    guideInstruction = 'Allocate a valid caster card for resource pooling';
                    updatePhaseGuide(guideInstruction,currentPhase);

                    // Unmark valid selection options
                    unmarkValidSelections();

                    // Mark valid selection options
                    markValidSelections('caster-card-type');

                }

            }

            // Move seletedresource into applicable pool
            function placeInPool(resourceSelection, playerField, cardAperture) {

                // Epheremal state handler
                jQuery(cardAperture).addClass('placingCard');

                if (jQuery(resourceSelection).find('.cardFront').hasClass('terra-motiv')) {
                    resourceMotiv = '.resource-terra .resource-aperture';
                } else if (jQuery(resourceSelection).find('.cardFront').hasClass('aero-motiv')) {
                    resourceMotiv = '.resource-aero .resource-aperture';
                } else if (jQuery(resourceSelection).find('.cardFront').hasClass('hydro-motiv')) {
                    resourceMotiv = '.resource-hydro .resource-aperture';
                } else if (jQuery(resourceSelection).find('.cardFront').hasClass('pyro-motiv')) {
                    resourceMotiv = '.resource-pyro .resource-aperture';
                }

                jQuery(resourceMotiv).parent('.resource').addClass('poolingResource');

                // Retrieve co-ordinates and dimensions of resource placeholder
                var placeholder = jQuery('[data-resource-field="'+playerField+'"]').find(resourceMotiv),
                    placeholderOffset = jQuery(placeholder).offset(),
                    placeholderTop = placeholderOffset.top,
                    placeholderLeft = placeholderOffset.left,
                    placeholderWidth = jQuery(placeholder).outerWidth(),
                    placeholderHeight = jQuery(placeholder).outerHeight();

                // Retrieve co-ordinates and dimensions of card aperture
                var cardApertureOffset = jQuery(cardAperture).offset(),
                    cardApertureTop = cardApertureOffset.top,
                    cardApertureLeft = cardApertureOffset.left;

                // Set relative co-ordinates
                var relativeTop = placeholderTop - cardApertureTop,
                    relativeLeft = placeholderLeft - cardApertureLeft;

                // Placing card
                jQuery(resourceSelection).addClass('activeCard activeResource speedX2');
                jQuery(resourceSelection).css({'top':relativeTop,'left':relativeLeft,'width':placeholderHeight,'height':placeholderWidth}); // in motion
                jQuery(resourceSelection).clone().appendTo(placeholder).removeClass('resourceSelection activeCard speedX2').addClass('activeResource ghostCard'); // clone the modifeid card and add to in-play placeholder

                // Remove resource tag
                resourceTagReference = jQuery(resourceSelection).attr('data-iteration');
                jQuery('.display-resource-value[data-tag-iteration="'+resourceTagReference+'"]').removeClass('activeResourceTag');

                // Calculate resource pool wealth
                resourceCurrentCount = Number(jQuery(placeholder).parent('.resource').find('.resource-counter').attr('data-pool-wealth'));
                resourceCurrency = jQuery(resourceSelection).attr('data-resource-currency');
                resourceUpdatedCount = resourceCurrentCount += resourceCurrency;

                setTimeout(function(){

                    jQuery(resourceSelection).remove();
                    jQuery('.activeResource').css({'top':'0','left':'0'}); // lock in position
                    jQuery('.activeResource').removeClass('ghostCard');
                    jQuery(cardAperture).removeClass('placingCard');
                    jQuery(cardAperture).addClass('tetherCard'); // tether card to aperture for return reference if necessary

                    // Update resource pool wealth
                    jQuery(placeholder).parent('.resource').find('.resource-counter').text(resourceUpdatedCount);
                    jQuery(placeholder).parent('.resource').find('.resource-counter').attr('data-pool-wealth',resourceUpdatedCount);

                    // Indicate active pool
                    if(!jQuery(placeholder).parent('.resource').hasClass('activePool')) {
                        jQuery(placeholder).parent('.resource').addClass('activePool');
                    }

                }, 200);

            }

            // Remove seleted resource from pool
            function removeFromPool(resourceSelection, playerField, cardAperture) {

                var resourceAperture = jQuery('[data-resource-field="'+playerField+'"]').find('.poolingResource .resource-aperture');

                // Epheremal state handler
                jQuery(resourceAperture).addClass('placingCard');

                // Retrieve co-ordinates and dimensions of resource placeholder
                var placeholder = jQuery('[data-resource-field="'+playerField+'"]').find(resourceAperture),
                    placeholderOffset = jQuery(placeholder).offset(),
                    placeholderTop = placeholderOffset.top,
                    placeholderLeft = placeholderOffset.left;

                // Retrieve co-ordinates and dimensions of card aperture
                var cardApertureOffset = jQuery(cardAperture).offset(),
                    cardApertureTop = cardApertureOffset.top,
                    cardApertureLeft = cardApertureOffset.left,
                    cardApertureWidth = jQuery(cardAperture).outerWidth(),
                    cardApertureHeight = jQuery(cardAperture).outerHeight();

                // Set relative co-ordinates
                var relativeTop = cardApertureTop - placeholderTop,
                    relativeLeft = cardApertureLeft - placeholderLeft;

                // Placing card
                jQuery(resourceSelection).removeClass('activeResource activeCard').addClass('inactiveResource speedX2');
                jQuery(resourceSelection).css({'top':relativeTop,'left':relativeLeft,'width':cardApertureWidth,'height':cardApertureHeight}); // in motion
                jQuery(resourceSelection).clone().appendTo(cardAperture).removeClass('speedX2').addClass('ghostCard'); // clone the modifeid card and add to in-play placeholder

                // Reset resource pool wealth
                resourceUpdatedCount = resourceCurrentCount -= resourceCurrency;

                setTimeout(function(){

                    jQuery(resourceSelection).remove();
                    jQuery('.inactiveResource').css({'top':'0','left':'0'}); // lock in position
                    jQuery('.inactiveResource').removeClass('inactiveResource ghostCard');
                    jQuery(cardAperture).removeClass('tetherCard open');
                    jQuery(cardAperture).addClass('closed valid-for-selection'); // restore former aperture classes
                    jQuery(resourceAperture).removeClass('placingCard poolingResource');

                    // Restore resource tag
                    resourceTagReference = jQuery(resourceSelection).attr('data-iteration');
                    jQuery('.display-resource-value[data-tag-iteration="'+resourceTagReference+'"]').addClass('activeResourceTag');

                    // Reset resource pool wealth
                    jQuery(resourceAperture).parent('.resource').find('.resource-counter').text(resourceUpdatedCount);
                    jQuery(resourceAperture).parent('.resource').find('.resource-counter').attr('data-pool-wealth',resourceUpdatedCount);

                    // Indicate inactive pool
                    if(jQuery(resourceAperture).parent('.resource').hasClass('activePool') && jQuery(resourceAperture).children().length <= 0) {
                        jQuery(resourceAperture).parent('.resource').removeClass('activePool');
                    }

                }, 200);

            }

            // Display resource value tags
            function displayResourceValueTags() {

                var resourceValue,
                    resourceDiscipline,
                    resourceDisciplineTag,
                    resourceTagIteration,
                    resourceValueTag = '<div class="display-resource-value"></div>';

                jQuery('.valid-for-selection').each(function(i){

                    // Retrieve co-ordinates of card aperture
                    var cardApertureOffset = jQuery(this).offset(),
                        cardApertureWidth = jQuery(cardAperture).outerWidth() - 5,
                        cardApertureTop = cardApertureOffset.top - 5,
                        cardApertureLeft = cardApertureOffset.left + cardApertureWidth;

                    resourceValue = jQuery(this).find('.card-resource-currency').children().length;
                    resourceDiscipline = jQuery(this).find('.card-discipline').text();
                    resourceTagIteration = jQuery(this).find('.card').attr('data-iteration');

                    switch(resourceDiscipline) {
                        case 'aero':
                            resourceDisciplineTag = 'aero-tag';
                        break;
                        case 'terra':
                            resourceDisciplineTag = 'terra-tag';
                        break;
                        case 'hydro':
                            resourceDisciplineTag = 'hydro-tag';
                        break;
                        case 'pyro':
                            resourceDisciplineTag = 'pyro-tag';
                        break;
                    }

                    jQuery('[data-field="'+playerField+'"]').append(jQuery(resourceValueTag).text(resourceValue).css({'left':cardApertureLeft,'top':cardApertureTop}).addClass(resourceDisciplineTag).attr('data-tag-iteration',resourceTagIteration));

                });

                jQuery('.display-resource-value').addClass('activeResourceTag');

            }

            // Adjust tag positionings on window resize
            jQuery(window).on('resize',function(){

                jQuery('.display-resource-value').each(function(){

                    resourceTagReference = jQuery(this).attr('data-tag-iteration');

                    // Retrieve co-ordinates of card aperture
                    var cardApertureReference = jQuery('.card[data-iteration="'+resourceTagReference+'"]').parent('.valid-for-selection');
                        cardApertureOffset = jQuery(cardApertureReference).offset(),
                        cardApertureWidth = jQuery(cardAperture).outerWidth() - 5,
                        cardApertureTop = cardApertureOffset.top - 5,
                        cardApertureLeft = cardApertureOffset.left + cardApertureWidth;

                    jQuery(this).css({'left':cardApertureLeft,'top':cardApertureTop});

                });

            });

            // Remove resource value tags
            function removeResourceValueTags() {

                jQuery('.display-resource-value').removeClass('activeResourceTag');

                setTimeout(function(){
                    jQuery('.display-resource-value').remove();
                },500);

            }

            /*
            **
            ** Browse & Preview Phase
            **
            */
            var browsingSelection,
                playerHandSource,
                previewPane,
                previewForce,
                previewDiscipline,
                previewDescription,
                previewResourceCurrency,
                previewResourceCurrencyHTML,
                previewResourceCost,
                previewResourceCostHTML,
                previewSupport,
                previewRank;

            function browseAndPreview() {

                jQuery('.preview-pane-component').removeClass('inView');
                jQuery('.preview-pane-component .preview-pane-card').children('.card-aperture').remove();

                playerHandSource = jQuery('.player-hand .focus').parents('.field').attr('data-field'),
                previewPane = jQuery('.field[data-field="'+playerHandSource+'"]').find('.preview-pane-component');

                browseHandPhase = false;
                previewSelectionPhase = true;
                currentPhase = 'previewSelectionPhase';

                // Update phase indicator
                updatePhaseIndicator();

                // Display preview pane
                if(!jQuery(previewPane).hasClass('inView')) {
                    jQuery(previewPane).addClass('inView');
                }

                // Append card to preview pane
                browsingSelection = jQuery('.field[data-field="'+playerHandSource+'"]').find('.focus').clone().removeClass('focus closed').appendTo('.inView .preview-pane-card');

                // Reset preview stats
                jQuery('.preview-pane-stats').children().remove();
                jQuery('.preview-pane-stats').removeClass(function (index, className) {
                    return (className.match (/(^|\s)stat-discipline-\S+/g) || []).join(' ');
                });

                // Prepare preview stats
                previewRank = jQuery(browsingSelection).find('.card-ranking').children().length;
                previewDiscipline = jQuery(browsingSelection).find('.card-discipline').text();

                if(jQuery(browsingSelection).find('.cardFront').hasClass('caster-card-type')) {

                    previewForce = jQuery(browsingSelection).find('.card-force').text();
                    previewResourceCurrency = jQuery(browsingSelection).find('.card-resource-currency').children().length;
                    previewResourceCurrencyHTML = jQuery(browsingSelection).find('.card-resource-currency').html();

                }

                if(jQuery(browsingSelection).find('.cardFront').hasClass('support-card-type')) {

                    previewDescription = jQuery(browsingSelection).find('.support-description').html();
                    previewResourceCost = jQuery(browsingSelection).find('.resource-cost').attr('data-resource-cost');
                    previewResourceCostHTML = jQuery(browsingSelection).find('.resource-cost').html();

                }

                // Set preview stats
                if(jQuery(browsingSelection).find('.cardFront').hasClass('caster-card-type')) {

                    jQuery('.preview-pane-stats').prepend(  `<div class="stat-force">
                                                                <div class="stat-title">Force:</div>
                                                                <div class="stat-value">${previewForce}</div>
                                                            </div>`);

                    jQuery('.preview-pane-stats').prepend(  `<div class="stat-resource-currency">
                                                                <div class="stat-title">Reource Value:</div>
                                                                <div class="stat-value">${previewResourceCurrency}${previewResourceCurrencyHTML}</div>
                                                            </div>`);

                } else if(jQuery(browsingSelection).find('.cardFront').hasClass('support-card-type')) {

                    jQuery('.preview-pane-stats').prepend(  `<div class="stat-description">
                                                                <div class="stat-title">Description:</div>
                                                                <div class="stat-value">${previewDescription}</div>
                                                            </div>`);

                    jQuery('.preview-pane-stats').prepend(  `<div class="stat-resource-cost">
                                                                <div class="stat-title">Resource Cost:</div>
                                                                <div class="stat-value">${previewResourceCost}${previewResourceCostHTML}</div>
                                                            </div>`);

                }

                switch(previewDiscipline) {

                    case 'aero' :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-discipline">
                                                                    <div class="stat-title">Discipline:</div>
                                                                    <div class="stat-value"><i class="fas fa-cloud"></i> Aerolurgy</div>
                                                                </div>`);

                        // Handle classes
                        jQuery('.preview-pane-stats').removeClass(function (index, className) {
                            return (className.match (/(^|\s)stat-discipline-\S+/g) || []).join(' ');
                        });
                        jQuery('.preview-pane-stats').addClass('stat-discipline-aero');
                    break;

                    case 'terra' :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-discipline">
                                                                    <div class="stat-title">Discipline:</div>
                                                                    <div class="stat-value"><i class="fas fa-leaf"></i> Terralurgy</div>
                                                                </div>`);

                        // Handle classes
                        jQuery('.preview-pane-stats').removeClass(function (index, className) {
                            return (className.match (/(^|\s)stat-discipline-\S+/g) || []).join(' ');
                        });
                        jQuery('.preview-pane-stats').addClass('stat-discipline-terra');
                    break;

                    case 'pyro' :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-discipline">
                                                                    <div class="stat-title">Discipline:</div>
                                                                    <div class="stat-value"><i class="fas fa-burn"></i> Pyrolurgy</div>
                                                                </div>`);

                        // Handle classes
                        jQuery('.preview-pane-stats').removeClass(function (index, className) {
                            return (className.match (/(^|\s)stat-discipline-\S+/g) || []).join(' ');
                        });
                        jQuery('.preview-pane-stats').addClass('stat-discipline-pyro');
                    break;

                    case 'hydro' :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-discipline">
                                                                    <div class="stat-title">Discipline:</div>
                                                                    <div class="stat-value"><i class="fas fa-tint"></i> Hydrolurgy</div>
                                                                </div>`);

                        // Handle classes
                        jQuery('.preview-pane-stats').removeClass(function (index, className) {
                            return (className.match (/(^|\s)stat-discipline-\S+/g) || []).join(' ');
                        });
                        jQuery('.preview-pane-stats').addClass('stat-discipline-hydro');
                    break;

                }

                switch(previewRank) {

                    case 0 :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-rank">
                                                                    <div class="stat-title">Ranking:</div>
                                                                    <div class="stat-value">Neophyte</div>
                                                                </div>`);
                    break;

                    case 1 :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-rank">
                                                                    <div class="stat-title">Ranking:</div>
                                                                    <div class="stat-value">Proficient</div>
                                                                </div>`);
                    break;

                    case 2 :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-rank">
                                                                    <div class="stat-title">Ranking:</div>
                                                                    <div class="stat-value">Adept</div>
                                                                </div>`);
                    break;

                    case 3 :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-rank">
                                                                    <div class="stat-title">Ranking:</div>
                                                                    <div class="stat-value">Elite</div>
                                                                </div>`);
                    break;

                    case 4 :
                        jQuery('.preview-pane-stats').prepend(  `<div class="stat-rank">
                                                                    <div class="stat-title">Ranking:</div>
                                                                    <div class="stat-value">Peerless</div>
                                                                </div>`);
                    break;

                }

            }

            /*
            **
            ** Browse Hand Phase
            **
            */

            // Select with mouse
            jQuery('.player-hand').on('click mouseover','.focus',function() {

                if(!jQuery('.preview-pane-component').hasClass('preview-pane-delay') && browseHandPhase || previewSelectionPhase) {

                    browseAndPreview();

                }

            });

            // Select with keys
            function keyViewSelection() {

                if(!jQuery('.preview-pane-component').hasClass('preview-pane-delay') && browseHandPhase || previewSelectionPhase) {

                    browseAndPreview();

                }

            }

            /*
            **
            ** Preview Selection Phase
            **
            */

            // Dismiss with mouse
            jQuery('.field').on('click','.preview-pane-dismiss',function() {

                previewSelectionPhase = false;
                browseHandPhase = true;
                currentPhase = 'browseHandPhase';

                // Update phase indicator
                updatePhaseIndicator();

                // Dismiss preview pane
                jQuery('.preview-pane-component').removeClass('inView').addClass('preview-pane-delay');

                // Remove delay
                setTimeout(function(){
                    jQuery('.preview-pane-component').removeClass('preview-pane-delay')
                },1000);

            });

            // Dismiss with keys
            function keyDismissPreview() {

                previewSelectionPhase = false;
                browseHandPhase = true;
                currentPhase = 'browseHandPhase';

                // Update phase indicator
                updatePhaseIndicator();

                // Dismiss preview pane
                jQuery('.preview-pane-component').removeClass('inView').addClass('preview-pane-delay');

                // Remove delay
                setTimeout(function(){
                    jQuery('.preview-pane-component').removeClass('preview-pane-delay')
                },1000);

            }

            /*
            **
            ** Ignore Key Input
            **
            */
            function keyVoid() {
                return
            }

            /*
            **
            ** Navigating Elements
            **
            */
            var keyReleased = false,
                keyPressed = true;

            function keyNavigation() {

                jQuery(document).on('keyup',function(e) {

                    keyReleased = true;

                });

                jQuery(document).on('keydown',function(e) {

                    if(keyReleased) {
                        keyPressed = true;
                    }

                    if(keyPressed) {

                        keyPressed = false;

                        var key = e.key;

                        if (turnSelectPhase) {

                            var elClass             = '.turnCard',
                                parentEl            = '.turnCard-selection',
                                callbackFunction    = keyTurnSelect,
                                returnFunction      = keyVoid,
                                applicableEl        = '.turnCard',
                                notApplicableEl     = '';

                        } else if (casterSelectionPhase) {

                            var elClass             = '.card-aperture',
                                parentEl            = '.player-hand',
                                callbackFunction    = keySelectCaster,
                                returnFunction      = keyVoid,
                                applicableEl        = '.valid-for-selection',
                                notApplicableEl     = '.invalid-for-selection, .open';

                        } else if (resourcePoolPhase) {

                            var elClass             = '.card-aperture',
                                parentEl            = '.player-hand',
                                callbackFunction    = keySelectResource,
                                returnFunction      = keyVoid,
                                applicableEl        = '.valid-for-selection',
                                notApplicableEl     = '.invalid-for-selection, .open';

                        } else if (supportSelectionPhase) {

                            var elClass             = '.card-aperture',
                                parentEl            = '.player-hand',
                                callbackFunction    = keySelectSupport,
                                returnFunction      = keyVoid,
                                applicableEl        = '.valid-for-selection',
                                notApplicableEl     = '.invalid-for-selection, .open';

                        } else if (confirmHandPhase) {

                            var elClass             = '.btn',
                                parentEl            = '.confirm-options',
                                callbackFunction    = keyConfirmation,
                                returnFunction      = toggleDockDialogueBox,
                                applicableEl        = '.btn-confirm',
                                notApplicableEl     = '';

                        } else if (browseHandPhase) {

                            var elClass             = '.card-aperture',
                                parentEl            = '.player-hand',
                                callbackFunction    = keyViewSelection,
                                returnFunction      = toggleDockDialogueBox,
                                applicableEl        = '.closed',
                                notApplicableEl     = '.open';

                        } else if (previewSelectionPhase) {

                            var elClass             = '.card-aperture',
                                parentEl            = '.player-hand',
                                callbackFunction    = keyViewSelection,
                                returnFunction      = keyDismissPreview,
                                applicableEl        = '.closed',
                                notApplicableEl     = '.open';

                        } else if (confirmCasterPhase) {

                            var elClass             = '.btn',
                                parentEl            = '.confirm-options',
                                callbackFunction    = keyConfirmation,
                                returnFunction      = toggleDialogueBox,
                                applicableEl        = '.btn-confirm',
                                notApplicableEl     = '';

                        } else if (confirmResourcePhase) {

                            var elClass             = '.btn',
                                parentEl            = '.confirm-options',
                                callbackFunction    = keyConfirmation,
                                returnFunction      = toggleDialogueBox,
                                applicableEl        = '.btn-confirm',
                                notApplicableEl     = '';

                        }

                        if(jQuery(parentEl).find(applicableEl).hasClass('focus')) {

                            agentFocus(key,elClass,parentEl,callbackFunction,returnFunction,applicableEl,notApplicableEl);

                        } else {

                            agentFocus(key,elClass,parentEl,callbackFunction,returnFunction,applicableEl,notApplicableEl);

                        }

                    }

                });

            }

            /*
            **
            ** Key Input Navigation
            **
            */
            function agentFocus(key,el,parent,callbackFunction,returnFunction,applicable,notApplicable) {

                var focusEl = jQuery(el+'.focus');

                function arrowRightUp() {

                    // are there more than one element in the set that can be focussed on?
                    if (jQuery(applicable).length > 1) {

                        if (
                            // is there an element following the current element?
                            jQuery(focusEl).next().length 
                            // and is it one that can be focussed on?
                            &&  jQuery(focusEl).next().is(applicable) 
                            || // OR
                            // is there an element following the current element?
                            jQuery(focusEl).next().length 
                            // and is it one that cannot be focussed on?
                            &&  jQuery(focusEl).next().is(notApplicable)
                            // and is it not the last element in the set? 
                            &&  jQuery(focusEl).next().is(':not(:last-child)')
                            ) {

                            // determine if there are any applicable elements following the current focussed element
                            if (jQuery(focusEl).nextAll(applicable).length) {
                                jQuery(focusEl).removeClass('focus').nextAll(applicable).first().addClass('focus'); // check all and apply class to first applicable element
                            } else {
                                jQuery(focusEl).removeClass('focus'); // remove class from current focus element
                                jQuery(parent).children(applicable).first().addClass('focus'); // reset focus on first applicable element of the containing element
                            }

                        } else if (
                            // is there an element following the current element?
                            jQuery(focusEl).next().length 
                            // and is it one that cannot be focussed on?
                            &&  jQuery(focusEl).next().is(notApplicable) 
                             // and is it the last element in the set? 
                            &&  jQuery(focusEl).next().is(':last-child')
                            ) {

                            jQuery(focusEl).removeClass('focus'); // remove class from current focus element
                            jQuery(applicable).first().addClass('focus'); // reset focus on the first element that can be focussed on (the first applicable element)

                        } else {

                            // otherwise just reset the focus
                            jQuery(focusEl).removeClass('focus'); // remove class from current focus element
                            jQuery(parent).children(applicable).first().addClass('focus'); // reset focus on first applicable element of the containing element

                        }

                    } else { // is it the only applicable element left in the set that can be focussed on?

                        // is the last applicable element left not already focussed on?
                        if (!jQuery(parent).children(applicable).first().hasClass('focus')) {
                            jQuery(parent).children(applicable).first().addClass('focus');
                        }

                    }
                    
                }

                function arrowLeftDown() {

                    // are there more than one element in the set that can be focussed on?
                    if (jQuery(applicable).length > 1) {

                        if(
                            // is there an element preceding the current element?
                            jQuery(focusEl).prev().length 
                            // and is it one that can be focussed on?
                            &&  jQuery(focusEl).prev().is(applicable) 
                            || // OR
                            // is there an element preceding the current element?
                            jQuery(focusEl).prev().length 
                            // and is it one that cannot be focussed on?
                            &&  jQuery(focusEl).prev().is(notApplicable)
                            // and is it not the first element in the set? 
                            &&  jQuery(focusEl).prev().is(':not(:first-child)')
                            ) {

                            // determine if there are any applicable elements preceding the current focussed element
                            if(jQuery(focusEl).prevAll(applicable).length) {
                                jQuery(focusEl).removeClass('focus').prevAll(applicable).first().addClass('focus'); // check all and apply class to first applicable element
                            } else {
                                jQuery(focusEl).removeClass('focus'); // remove class from current focus element
                                jQuery(parent).children(applicable).last().addClass('focus'); // reset focus on last applicable element of the containing element
                            }

                        } else if (
                            // is there an element preceding the current element?
                            jQuery(focusEl).prev().length 
                            // and is it one that cannot be focussed on?
                            &&  jQuery(focusEl).prev().is(notApplicable) 
                             // and is it the first element in the set? 
                            &&  jQuery(focusEl).prev().is(':first-child')
                            ) {

                            jQuery(focusEl).removeClass('focus'); // remove class from current focus element
                            jQuery(applicable).last().addClass('focus'); // reset focus on the last element that can be focussed on (the last applicable element)

                        } else {

                            // otherwise just reset the focus
                            jQuery(focusEl).removeClass('focus'); // remove class from current focus element
                            jQuery(parent).children(applicable).last().addClass('focus'); // reset focus on last applicable element of the containing element

                        }

                    } else { // is it the only applicable element left in the set that can be focussed on?

                        // is the last applicable element left not already focussed on?
                        if (!jQuery(parent).children(applicable).first().hasClass('focus')) {
                            jQuery(parent).children(applicable).first().addClass('focus');
                        }

                    }
                    
                }

                function switchHands(key) {

                    var current_field = jQuery('.focus').parents('.field').attr('data-field');
                    jQuery(applicable).removeClass('focus');

                    if(key == 'ArrowUp') {

                        if(jQuery('.field[data-field!="'+current_field+'"]').find(applicable).length) {    
                            jQuery('.field[data-field!="'+current_field+'"]').find(applicable).first().addClass('focus');
                        } else {
                            arrowRightUp();
                        }


                    } else if(key == 'ArrowDown') {

                        if(jQuery('.field[data-field!="'+current_field+'"]').find(applicable).length) { 
                            jQuery('.field[data-field!="'+current_field+'"]').find(applicable).last().addClass('focus');
                        } else {
                            arrowLeftDown();
                        }

                    }

                }

                switch(key) {

                    case 'ArrowRight':
                        arrowRightUp();
                    break;

                    case 'ArrowLeft':
                        arrowLeftDown();
                    break;

                    case 'ArrowUp':
                        if(browseHandPhase || previewSelectionPhase || casterSelectionPhase) {
                            switchHands(key);
                        } else {
                            arrowRightUp();
                        }
                    break;

                    case 'ArrowDown':
                        if(browseHandPhase || previewSelectionPhase || casterSelectionPhase) {
                            switchHands(key);
                        } else {
                            arrowLeftDown();
                        }
                    break;

                    case 'Enter':
                        callbackFunction();
                    break;

                    case 'Escape':
                        returnFunction();
                    break;

                }

            };
        </script>
        <style>
            * {
                box-sizing: border-box;
                font-family: arial;
            }
            body {
                margin: auto;
            }
            hr {
                color: #404040;
                border-style: solid;
            }
            .wrapper {
                background: #504f4f;
            }
            /* || States */
            .idleCard {
                transform: rotate(90deg) translateY(-20px) translateX(-20px) scaleX(1);
                top: 0;
                left: 0;
            }
            .activeCard {
                position: absolute;
                transform: rotate(0deg) translateY(0px) translateX(0px) scaleX(1);
                z-index: 2;
            }
            .ghostCard {
                display: none;
            }
            .facedownCard {
                transform: rotate(0deg) translateY(0px) translateX(0px) scaleX(1);
            }
            .flippedCard {
                transform: rotate(0deg) translateY(0px) translateX(0px) scaleX(-1);
            }
            .placingCard.open,
            .placingCard.closed,
            .placingCard.in-play {
                z-index: 9;
            }
            /* || Cards */
            .card {
                background: #504f4f;
                transition: .5s;
                z-index: 1;
                position: absolute;
            }
            .card-force,
            .card-support {
                position: absolute;
                display: block;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                font-size: 30px;
                margin: auto;
                border-radius: 100%;
                background: #404040;
                text-align: center;
                line-height: 90px;
                color: #b3b3b3;
            }
            .card-force {
                width: 90px;
                height: 90px;
            }
            .card-support {
                width: 102px;
                height: 102px;
            }
            .card-force-indicator {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                margin: auto;
                width: 102px;
                height: 102px;
                border: 1px solid #404040;
                border-radius: 100%;
            }
            .card-force-indicator div {
                position: absolute;
                width: 1px;
                height: 10px;
            }
            .elite-force-indicator {
                background: gold;
                transform: rotate(140deg);
                top: 5px;
                left: 20px;
            }
            .adept-force-indicator {
                background: silver;
                transform: rotate(110deg);
                top: 30px;
                left: 2px;
            }
            .proficient-force-indicator {
                background: #cd7f32;
                transform: rotate(70deg);
                bottom: 30px;
                left: 2px;
            }
            .card-force-indicator circle {
                fill: #504f4f;
                stroke-width: 32;
                transition: .5s;
            }
            .aero-motiv .card-force-indicator circle {
                stroke: #f1c40f;
            }
            .terra-motiv .card-force-indicator circle {
                stroke: #27ae60;
            }
            .pyro-motiv .card-force-indicator circle {
                stroke: #c0392b;
            }
            .hydro-motiv .card-force-indicator circle {
                stroke: #3498db;
            }
            .card-force-indicator svg {
                width: 100px;
                height: 100px;
                transform: rotate(-90deg);
                background: #655;
                border-radius: 50%;
            }
            .card-force-indicator svg:after {
                content: "";
                width: 2px;
                height: 10px;
                background: black;
                position: absolute;
                display: block;
            }
            .card-type {
                color: #404040;
                position: absolute;
                bottom: 5px;
                left: 0;
                right: 0;
                text-transform: uppercase;
                font-size: 12px;
            }
            .support-description, 
            .support-efficacy {
                display: none;
            }
            .support-type {
                text-transform: uppercase;
                font-size: 15px;
                position: absolute;
                left: 0;
                right: 0;
                text-align: center;
                top: 0;
                bottom: 0;
                height: 0;
                margin: auto;
            }
            .card-support-motiv .fas:nth-child(2) {
                position: absolute;
                font-size: 20px;
                top: 0;
                bottom: 0;
                right: 25px;
                height: 50px;
                margin: auto;
                display: block;
            }
            .card-support-motiv .fas:nth-child(1) {
                color: #7d7d7d;
                font-size: 40px;
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                height: 40px;
                margin: auto;
            }
            .card-support-motiv {
                position: relative;
                text-align: center;
                height: 100%;
            }
            .cardBack {
                border: 3px solid #404040;
                position: absolute;
                top: 0;
                bottom: 0;
                right: 0;
                left: 0;
                border-radius: 5px;
            }
            .cardBack div {
                transition: .5s;
            }
            .cardFront {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                border: 3px solid #404040;
                border-radius: 5px;
            }
            .cardFront div {
                transition: .5s;
            }
            .activeCaster .cardFront .card-number,
            .activeCard .cardFront .card-number {
                top: 20px;
                left: 20px;
                transform: scale(2);
            }
            .activeCaster .cardFront .card-discipline,
            .activeCard .cardFront .card-discipline {
                top: 15px;
                right: 20px;
                transform: scale(2);
            }
            .activeCaster .cardFront .card-resource-currency,
            .activeCard .cardFront .card-resource-currency {
                right: 5px;
                top: 35px;
                width: 15px;
            }
            .activeCaster .cardFront .card-resource-currency .fas,
            .activeCard .cardFront .card-resource-currency .fas {
                font-size: 10px;
                line-height: 15px;
            }
            .activeCaster .cardFront,
            .activeCard .cardFront {
                border-width: 10px;
                border-radius: 10px;
            }
            .activeCaster .cardFront .card-elemental-motif, 
            .activeCaster .cardFront .card-force,
            .activeCaster .cardFront .card-ranking,
            .activeCaster .cardFront .card-type,
            .activeCaster .cardFront .card-force-indicator,
            .activeCard .cardFront .card-elemental-motif, 
            .activeCard .cardFront .card-force, 
            .activeCard .cardFront .card-ranking,
            .activeCard .cardFront .card-type,
            .activeCard .cardFront .card-force-indicator {
                transform: scale(2.3);
            }
            .activeCaster .cardFront .card-type, 
            .activeCard .cardFront .card-type {
                bottom: 20px;
                font-size: 10px;
            }
            .activeCaster .cardFront .card-ranking,
            .activeCard .cardFront .card-ranking {
                bottom: 90px;
            }
            .card-number {
                position: absolute;
                display: block;
                top: 3px;
                left: 3px;
                width: 25px;
                height: 25px;
                font-size: 15px;
                margin: auto;
                border-radius: 100%;
                border-top-left-radius: 0;
                background: #404040;
                text-align: center;
                line-height: 25px;
                color: #b3b3b3;
            }
            .card-discipline {
                position: absolute;
                right: 3px;
                top: 3px;
                color: #b3b3b3;
                font-size: 10px;
                text-transform: uppercase;
            }
            .card-resource-currency {
                position: absolute;
                right: 3px;
                top: 17px;
                width: 8px;
            }
            .card-resource-currency .fas {
                font-size: 5px;
                display: block;
                line-height: 8px;
            }
            .card-logo {
                position: absolute;
                bottom: 10px;
                left: 0;
                right: 0;
                text-align: center;
                margin: auto;
                display: block;
                height: 20px;
                line-height: 20px;
                font-size: 8px;
                letter-spacing: 2px;
                text-transform: uppercase;
                color: #b3b3b3;
                background: #404040;
            }
            .card-motivs {
                color: #404040;
                position: absolute;
                top: 10px;
                left: 0;
                right: 0;
                width: 58px;
                height: 58px;
                border-radius: 100%;
                border: 1px solid #404040;
                margin: auto;
            }
            .card-motivs .fas {
                position: absolute;
                margin: auto;
                display: block;
                height: 20px;
                text-align: center;
                font-size: 17px;
                color: #404040;
            }
            .card-motivs .fas:nth-child(1) {
                top: -7px;
                bottom: auto;
                left: 0;
                right: 0;
            }
            .card-motivs .fas:nth-child(2) {
                top: 0;
                bottom: 0;
                left: auto;
                right: -5px;
            }
            .card-motivs .fas:nth-child(3) {
                top: auto;
                bottom: -7px;
                left: 0;
                right: 0;
            }
            .card-motivs .fas:nth-child(4) {
                top: 0;
                bottom: 0;
                left: -5px;
                right: auto;
            }
            .activeCard .card-logo {
                height: 35px;
                line-height: 35px;
                font-size: 1em;
                letter-spacing: 3px;
            }
            .activeCard .card-motivs {
                width: 120px;
                height: 120px;
            }
            .activeCard .card-motivs .fas {
                font-size: 25px;
            }
            .activeCard .card-motivs .fas:nth-child(1) {
                width: 25px;
                top: -10px;
            }
            .activeCard .card-motivs .fas:nth-child(3) {
                width: 25px;
                bottom: -10px;
            }
            .activeCard .card-motivs .fas:nth-child(2) {
                height: 25px;
                right: -10px;
            }
            .activeCard .card-motivs .fas:nth-child(4) {
                height: 25px;
                left: -10px;
            }
            .elite-ranking {
                border-color: gold;
                border-bottom-color: rgba(255, 215, 0, 0.7);
                border-right-color: rgba(255, 215, 0, 0.7);
            }
            .adept-ranking {
                border-color: silver;
                border-bottom-color: rgba(192, 192, 192, 0.7);
                border-right-color: rgba(192, 192, 192, 0.7);
            }
            .proficient-ranking {
                border-color: #cd7f32;
                border-bottom-color: rgba(205, 127, 50, 0.7);
                border-right-color: rgba(205, 127, 50, 0.7);
            }
            .peerless-ranking {
                background: #2b2b2b;
                border-color: #1d1d1d;
            }
            .peerless-ranking .card-number {
                background: #1d1d1d;
                color: white;
                border: 1px solid white;
            }
            .peerless-ranking .card-discipline {
                color: white;
            }
            .peerless-ranking .card-force,
            .peerless-ranking .card-support {
                background: #2b2b2b;
                color: white;
                border: 3px solid #131313;
            }
            .peerless-ranking .card-type {
                color: #b3b3b3;
            }
            .card-ranking {
                position: absolute;
                text-align: center;
                bottom: 50px;
                left: 0;
                right: 0;
                font-size: 10px;
                letter-spacing: 2px;
            }
            .peerless-ranking .card-ranking .far {
                color: white;
            }
            .elite-ranking .card-ranking .fas {
                color: gold;
            }
            .adept-ranking .card-ranking .fas {
                color: silver;
            }
            .proficient-ranking .card-ranking .fas {
                color: #cd7f32;
            }
            .card-resource-cost {
                position: absolute;
                text-align: center;
                bottom: 30px;
                left: 0;
                right: 0;
                font-size: 10px;
                letter-spacing: 2px;
            }
            .card-resource-cost .fas,
            .card-resource-cost .far {
                color: #404040;
            }
            .resource-cost {
                letter-spacing: 0px;
            }
            .card-elemental-motif {
                position: absolute;
                left: 0;
                right: 0;
                font-size: 30px;
                text-align: center;
                top: 0;
                bottom: 0;
                height: 155px;
                margin: auto;
            }
            .aero-motiv .fas {
                color: #f1c40f;
            }
            .terra-motiv .fas {
                color: #27ae60;
            }
            .pyro-motiv .fas {
                color: #c0392b;
            }
            .hydro-motiv .fas {
                color: #3498db;
            }
            .scaleSmall .cardFront div {
                transform: scale(.7);
            }
            .scaleSmall .card-support, 
            .scaleSmall .card-force {
                width: 63px;
                height: 63px;
                font-size: 25px;
                line-height: 63px;
                bottom: 10px;    
                left: -3px;
            }
            .scaleSmall .card-force-indicator, 
            .scaleSmall .card-force-indicator svg {
                width: 70px;
                height: 70px;
                position: absolute;
                overflow: hidden;
                margin: auto;
            }
            .scaleSmall .card-force-indicator {
                top: 0;
                left: -5px;
                right: 0;
                bottom: 10px;
            }
            .scaleSmall .card-force-indicator svg {
                bottom: 0;
                top: 0;
                left: 0;
                right: 0;
            }
            .scaleSmall .card-elemental-motif {
                font-size: 15px;
                height: 108px;
            }
            .scaleSmall .card-type {
                bottom: 2px;
            }
            .scaleSmall .card-ranking {
                bottom: 25px;
            }
            .scaleSmall .card-number {
                left: 0;
                top: 0;
                font-size: 10px;
                width: 20px;
                height: 20px;
                line-height: 20px;
            }
            .scaleSmall .card-discipline {
                right: 0;
                top: 0;
            }
            .scaleSmall .card-resource-currency {
                top: 7px;
                right: 2px;
            }
            .scaleSmall .card-resource-currency .fas {
                font-size: 3px;
                line-height: 5px;
            }
            .scaleSmall .card-resource-cost {
                bottom: 15px;
            }
            .scaleSmall .support-type {
                font-size: 12px;
            }
            .scaleSmall .card-support-motiv .fas:nth-child(2) {
                right: 5px;
            }
            .card-marker {
                color: white;
                position: absolute;
                text-transform: uppercase;
                top: 3px;
                left: 3px;
                padding: 0;
                background: #404040;
                text-align: right;
                border-radius: 10px;
                border-top-left-radius: 0;
                border-bottom-right-radius: 0;
                overflow: hidden;
                z-index: 1;
                height: 25px;
                width: 0;
            }
            .valid-for-selection .card-marker {
                width: 85px;
                padding: 5px 10px;
                transition: .3s;
            }
            .activeResource {
                transform: rotate(90deg) translateY(-7px) translateX(-8px) scaleX(1);
            }
            .activeResource .cardFront {
                border-width: 3px;
            }
            .activeResource .cardFront .card-force {
                transform: scale(.3);
                left: -28px;
            }
            .activeResource .cardFront .card-force-indicator {
                transform: scale(.3);
                left: -34px;
            }
            .activeResource .cardFront div.card-number,
            .activeResource .cardFront div.card-ranking,
            .activeResource .cardFront div.card-type,
            .activeResource .cardFront div.card-discipline,
            .activeResource .cardFront div.card-resource-currency,
            .activeResource .cardFront div.card-force-indicator div {
                display: none;
            }
            .inactiveResource .cardFront div.card-number,
            .inactiveResource .cardFront div.card-ranking,
            .inactiveResource .cardFront div.card-type,
            .inactiveResource .cardFront div.card-discipline,
            .inactiveResource .cardFront div.card-resource-currency,
            .inactiveResource .cardFront div.card-force-indicator div {
                display: none;
            }
            .activeResource .cardFront .card-elemental-motif {
                transform: scale(.3);
                height: 170px;
            }
            /* || UI */
            .btn {
                background: #404040;
                display: inline-block;
                min-width: 100px;
                text-align: center;
                padding: 5px 15px;
                transition: .5s;
                cursor: pointer;
            }
            .btn:hover {
                background: #353535;
            }
            .overview-component {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                z-index: 99;
                background: #404040;
                color: #b3b3b3;
                padding: 5px 10px;
                font-size: 15px;
                display: flex;
                justify-content: space-between;
            }
            .overview-component > div {
                display: inline-block;
            }
            .overview-component > div:first-child, 
            .overview-component > div:last-child {
                min-width: 250px;
            }
            .overview-component > div:first-child {
                text-align: left;
            }
            .overview-component > div:last-child {
                text-align: right;
            }
            .overview-win-indicator > div {
                display: inline-block;
                position: relative;
            }
            .overview-win-indicator > div:first-child {
                padding-right: 10px;
            }
            .overview-win-indicator > div:last-child {
                padding-left: 10px;
            }
            .overview-current-phase {
                text-transform: capitalize;
            }
            .overview-player-win:before {
                content: "Player";
            }
            .npc-player-win:before {
                content: "NPC";
            }
            .overview-win-indicator > div:before {
                font-size: 10px;
                position: absolute;
                line-height: 18px;
                text-transform: uppercase;
            }
            .overview-win-indicator > div:last-child:before {
                left: 100%;
                margin-left: 10px;
            }
            .overview-win-indicator > div:first-child:before {
                right: 100%;
                margin-right: 10px;
            }
            .overview-win-indicator > div:first-child:after {
                content: "";
                width: 1px;
                top: 0;
                bottom: 0;
                right: -3px;
                background: #504f4f;
                position: absolute;
            }
            .phaseGuide {
                position: fixed;
                bottom: 20px;
                background: rgba(64, 64, 64, 0.9);
                border: 2px solid #404040;
                z-index: 9;
                padding: 10px;
                border-top-right-radius: 15px;
                border-bottom-left-radius: 15px;
                color: #b3b3b3;
                transition: .2s;
                overflow: hidden;
            }
            .inactive-phaseGuide {
                left: -500px;
            }
            .active-phaseGuide {
                left: 20px;
            }
            .phaseGuide-current-phase {
                font-size: 30px;
                text-transform: capitalize;
                margin-bottom: 15px;
            }
            .turnCard-component {
                position: fixed;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                background: #504f4f;
                z-index: 9;
                padding: 15px;
            }
            .turnCard {
                width: 80px;
                height: 120px;
                border-radius: 5px;
                display: inline-block;
                margin: auto 5px;
                text-align: center;
                transition: .5s;
                cursor: pointer;
            }
            .turnCard .card {
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
            }
            .turnCard-hidden {
                position: absolute;
            }
            .turnCard-drawn {
                position: relative;
            }
            .turnCard-selection .turnCard-hidden {
                left: -1000px;
            }
            .turnCard-selection .turnCard-drawn {
                left: 0;
            }
            .turnCard-match .turnCard-hidden {
                top: -1000px;
            }
            .turnCard-match .turnCard-drawn {
                top: 0;
            }
            .turnCard-selection {
                text-align: center;
                display: flex;
                justify-content: center;
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                margin: auto;
            }
            .turnCard .cardFront .fas {
                position: absolute;
                top: 0;
                bottom: 0;
                right: 0;
                left: 0;
                font-size: 25px;
                height: 25px;
                margin: auto;
            }
            .turnCard[data-element="aero"] .cardFront .fas {
                color: #f1c40f;
            }
            .turnCard[data-element="hydro"] .cardFront .fas {
                color: #3498db;
            }
            .turnCard[data-element="terra"] .cardFront .fas {
                color: #27ae60;
            }
            .turnCard[data-element="pyro"] .cardFront .fas {
                color: #c0392b;
            }
            .turnCard.focus .card, 
            .turnCard .card:hover {
                background: #545454;
            }
            .turnCard-bg-lines div {
                height: 3px;
                position: fixed;
                left: 0;
                right: 0;
                bottom: 0;
                top: 0;
                background: #404040;
                margin: auto;
                max-width: 245px;
            }
            .turnCard-bg-lines div:before,
            .turnCard-bg-lines div:after {
                content: "";
                background: #404040;
                height: 3px;
                width: 150px;
                display: block;
                position: absolute;
                transform: rotate(50deg);
            }
            .turnCard-bg-lines div:before {
                left: 89%;
                top: 57px;
            }
            .turnCard-bg-lines div:after {
                right: 89%;
                bottom: 57px;
            }
            .turnCard-bg-lines div div:before, 
            .turnCard-bg-lines div div:after {
                content: "";
                background: #404040;
                height: 3px;
                width: 1000px;
                display: block;
                position: absolute;
                transform: rotate(0deg);
            }
            .turnCard-bg-lines div div:before {
                bottom: 114px;
                right: 139%;
                left: auto;
                top: auto;
            }
            .turnCard-bg-lines div div:after {
                top: 114px;
                left: 139%;
                right: auto;
                bottom: auto;
            }
            .turnCard-bg-lines {
                position: absolute;
                height: 232px;
                margin: auto;
                display: block;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
            }
            .turnCard-match {
                text-align: center;
                position: absolute;
                left: 0;
                right: 0;
                margin: auto;
                bottom: 0;
                top: 0;
                display: block;
                height: 450px;
            }
            .turnCard-match .turnCard {
                position: relative;
            }
            .turn {
                color: red;
            }
            .turn.active {
                color: green;
            }
            .deck-component {
                display: flex;
                vertical-align: top;
                justify-content: center;
                text-align: center;
            }
            .field[data-field="player-field"] .deck-component {
                flex-direction: row-reverse;
            }
            .field[data-field="ai-field"] .deck-component {
                flex-direction: row;
            }
            .dorment {
                display: inline-block;
                display: flex;
                flex-direction: column;
                position: relative;
            }
            .field[data-field="player-field"] .dorment {
                margin-right: 5px;
                justify-content: flex-start;
                align-items: flex-end;
            }
            .field[data-field="ai-field"] .dorment {
                margin-left: 5px;
                justify-content: flex-end;
                align-items: flex-start;
                margin-bottom: 5px;
            }
            .stack-counter {
                border: 1px solid #404040;
                border-radius: 5px;
                color: #b3b3b3;
                font-size: 20px;
                width: 40px;
                height: 55px;
                line-height: 50px;
                position: relative;
            }
            .stack-count-low {
                color: #c0392b;
            }
            .stack-counter span {
                background: #404040;
                border-radius: 100%;
                width: 30px;
                height: 30px;
                display: inline-block;
                line-height: 30px;
                vertical-align: middle;
                font-size: 15px;
            }
            .field[data-field="player-field"] .stack-counter span {
                border-top-left-radius: 0;
            }
            .field[data-field="ai-field"] .stack-counter span {
                border-bottom-right-radius: 0;
            }
            .stack-circuit {
                position: absolute;
                width: 35px;
                height: 35px;
            }
            .field[data-field="player-field"] .stack-circuit {
                right: 100%;
                top: -5px;
                border-left: 1px solid #404040;
                border-bottom: 1px solid #404040;
            }
            .field[data-field="ai-field"] .stack-circuit {
                left: 100%;
                bottom: -5px;
                border-right: 1px solid #404040;
                border-top: 1px solid #404040;
            }
            .stack-circuit:before,
            .stack-circuit:after {
                content: "";
                position: absolute;
            }
            .field[data-field="player-field"] .stack-circuit:before {
                left: -1px;
                bottom: -1px;
                border-left: 25px solid #404040;
                border-top: 25px solid transparent;
            }
            .field[data-field="ai-field"] .stack-circuit:before {
                right: -1px;
                top: -1px;
                border-right: 25px solid #404040;
                border-bottom: 25px solid transparent;
            }
            .field[data-field="player-field"] .stack-circuit:after {
                left: -1px;
                bottom: -1px;
                border-left: 23px solid #504f4f;
                border-top: 23px solid transparent;
            }
            .field[data-field="ai-field"] .stack-circuit:after {
                right: -1px;
                top: -1px;
                border-right: 23px solid #504f4f;
                border-bottom: 23px solid transparent;
            }
            .player-hand {
                display: inline-block;
            }
            .dorment > div:not(:last-child) {
                margin-bottom: 5px;
            }
            .field[data-field="ai-field"] .victory-indicator {
                margin-right: 20px;
            }
            .field[data-field="player-field"] .victory-indicator {
                margin-left: 20px;
            }
            .victory-indicator {
                display: flex;
                flex-direction: column;
                justify-content: center;
            }
            .victory-aperture {
                border-radius: 5px;
                border: 1px solid #404040;
                height: 75px;
                width: 55px;
                margin-bottom: 5px;
                position: relative;
                transition: .5s;
            }
            .victory-aperture:after {
                content: "";
                position: absolute;
                width: 20px;
                height: 1px;
                background: #404040;
                top: 0;
                bottom: 0;
                margin: auto;
            }
            .field[data-field="ai-field"] .victory-aperture:after {
                left: 100%;
            }
            .field[data-field="player-field"] .victory-aperture:after {
                right: 100%;
            }
            .victory-aperture.victorious {
                background: #0a800f;
                box-shadow: inset 0px 0px 0px 5px rgba(34, 101, 0, 0.7);
            }
            .turn-indicator {
                height: 35px;
                width: 35px;
                border-radius: 100%;
                position: absolute;
                background: transparent;
                box-shadow: inset 0px 0px 0px 0px transparent;
                transition: .5s;
                border: 1px solid #404040;
                z-index: 1;
            }
            .activeTurn {
                background: #0a800f;
                box-shadow: inset 0px 0px 0px 5px rgba(34, 101, 0, 0.7);
            }
            [data-field="player-field"] .turn-indicator {
                left: 0;
                bottom: 0;
                border-top-right-radius: 0;
            }
            [data-field="ai-field"] .turn-indicator {
                right: 0;
                top: 0;
                border-bottom-left-radius: 0;
            }
            .turn-indicator:after {
                content: "Turn";
                position: absolute;
                transition: .5s;
                opacity: 0;
                color: #b3b3b3;
                text-transform: uppercase;
                font-size: 12px;
            }
            .turn-indicator.activeTurn:after {
                opacity: 1;
            }
            [data-field="player-field"] .turn-indicator:after {
                left: 110%;
            }
            [data-field="ai-field"] .turn-indicator:after {
                right: 110%;
            }
            .field-component {
                position: relative;
                z-index: 1;
                background: #504f4f;
                padding-top: 30px;
            }
            .field {
                padding: 15px;
            }
            .preview-pane-component {
                position: fixed;
                z-index: 9;
                left: 0;
                right: 0;
                margin: auto;
                text-align: center;
                max-width: 550px;
                display: flex;
                justify-content: center;
                transition: .5s;
            }
            .field[data-field="player-field"] .preview-pane-component {
                top: -1000px;
            }
            .field[data-field="player-field"] .inView.preview-pane-component {
                top: 50px;
            }
            .field[data-field="ai-field"] .preview-pane-component {
                bottom: -1000px;
            }
            .field[data-field="ai-field"] .inView.preview-pane-component {
                bottom: 50px;
            }
            .preview-pane-dismiss {
                cursor: pointer;
                color: #404040;
                position: absolute;
                right: 100%;
                width: 25px;
                height: 25px;
                line-height: 25px;
                transition: .5s;
            }
            .preview-pane-dismiss:hover {
                color: #b3b3b3;
            }
            .preview-pane-aperture {
                width: 250px;
                height: 400px;
                background: rgba(80, 79, 79, 0.8);
                border: 1px solid #404040;
                margin: 0;
                position: relative;
                display: inline-block;
                vertical-align: top;
            }
            .preview-pane-aperture:last-child {
                border-top-right-radius: 10px;
                border-bottom-right-radius: 10px;
                border-left: 0;
            }
            .preview-pane-aperture:first-child {
                border-top-left-radius: 10px;
                border-bottom-left-radius: 10px;
                border-right: 0;
            }
            .preview-pane-card {
                height: 375px;
                width: 225px;
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                margin: auto;
            }
            .preview-pane-card .card-aperture {
                transform: scale(1.5);
                transform-origin: 2px 2px;
                left: 0;
                position: absolute;
            }
            .preview-pane-stats > div {
                padding: 5px 0;
                display: block;
                display: flex;
                justify-content: space-between;
            }
            .preview-pane-stats {
                padding: 15px 15px 15px 0;
                color: #b3b3b3;
                text-align: left;
            }
            .preview-pane-stats > div > div {
                display: inline-block;
            }
            .preview-pane-stats > div:not(:last-child) {
                border-bottom: 1px solid #404040;
            }
            .preview-pane-stats .stat-title {
                text-transform: uppercase;
                font-size: 13px;
            }
            .preview-pane-stats .stat-description {
                display: block;
            }
            .preview-pane-stats .stat-description .stat-title {
                margin-bottom: 10px;
            }
            .preview-pane-stats .stat-resource-currency .fas {
                width: 17px;
                text-align: right;
            }
            .preview-pane-stats .stat-resource-cost .fa-circle,
            .preview-pane-stats .stat-resource-currency .fa-circle {
                font-size: 12px;
            }
            .preview-pane-stats.stat-discipline-aero .stat-resource-cost .fas,
            .preview-pane-stats.stat-discipline-aero .stat-resource-currency .fas {
                color: #f1c40f;
            }
            .preview-pane-stats.stat-discipline-terra .stat-resource-cost .fas,
            .preview-pane-stats.stat-discipline-terra .stat-resource-currency .fas {
                color: #27ae60;
            }
            .preview-pane-stats.stat-discipline-pyro .stat-resource-cost .fas,
            .preview-pane-stats.stat-discipline-pyro .stat-resource-currency .fas {
                color: #c0392b;
            }
            .preview-pane-stats.stat-discipline-hydro .stat-resource-cost .fas,
            .preview-pane-stats.stat-discipline-hydro .stat-resource-currency .fas {
                color: #3498db;
            }
            .preview-pane-stats.stat-discipline-aero .stat-discipline .fas {
                color: #f1c40f;
            }
            .preview-pane-stats.stat-discipline-terra .stat-discipline .fas {
                color: #27ae60;
            }
            .preview-pane-stats.stat-discipline-pyro .stat-discipline .fas {
                color: #c0392b;
            }
            .preview-pane-stats.stat-discipline-hydro .stat-discipline .fas {
                color: #3498db;
            }
            .battle-field-component {
                padding: 5px 15px;
                text-align: center;
                display: flex;
                justify-content: center;
                position: relative;
            }
            .battle-field {
                display: inline-block;
                display: flex;
                margin: auto 10px;
                position: relative;
            }
            .battle-field-background {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                display: flex;
                justify-content: space-around;
            }
            .background-panel {
                position: absolute;
                top: -7px;
                bottom: -7px;
                width: 50%;
                flex-basis: 50%;
                color: #404040;
            }
            .background-panel-left {
                left: 0;
                border-bottom: 3px solid;
            }
            .background-panel-right {
                right: 0;
                border-top: 3px solid;
            }
            .background-panel-left .panel-corner:first-child {
                border-left: 80px solid #404040;
                border-top: 50px solid transparent;
                bottom: 0;
                left: 0;
            }
            .background-panel .panel-corner {
                position: absolute;
            }
            .background-panel-left .panel-corner:first-child:before {
                border-left: 80px solid #504f4f;
                border-top: 50px solid transparent;
                bottom: -3px;
                left: -82px;
            }
            .background-panel .panel-corner:before {
                content: "";
                position: absolute;
            }
            .background-panel-left .panel-corner:last-child {
                border-right: 50px solid #404040;
                border-top: 50px solid transparent;
                bottom: 0;
                right: 0;
            }
            .background-panel-left .panel-corner:last-child:before {
                border-right: 50px solid #504f4f;
                border-top: 50px solid transparent;
                bottom: -3px;
                right: -52px;
            }
            .background-panel-right .panel-corner:last-child:before {
                border-left: 50px solid #504f4f;
                border-bottom: 50px solid transparent;
                top: -3px;
                left: -52px;
            }
            .background-panel-right .panel-corner:last-child {
                border-left: 50px solid #404040;
                border-bottom: 50px solid transparent;
                top: 0;
                left: 0;
            }
            .background-panel-right .panel-corner:first-child:before {
                border-right: 80px solid #504f4f;
                border-bottom: 50px solid transparent;
                top: -3px;
                right: -82px;
            }
            .background-panel-right .panel-corner:first-child {
                border-right: 80px solid #404040;
                border-bottom: 50px solid transparent;
                top: 0;
                right: 0;
            }
            .background-panel-left:after {
                content: "";
                position: absolute;
                top: 45px;
                bottom: 48px;
                right: -2px;
                width: 3px;
                background: #404040;
            }
            .background-panel-right:before {
                content: "";
                position: absolute;
                top: 45px;
                bottom: 48px;
                left: -2px;
                width: 3px;
                background: #404040;
            }
            .dead-pile, 
            .dead-pile .card,
            .standby-pile, 
            .standby-pile .card {
                height: 120px;
                width: 80px;
                border-radius: 5px;
            }
            .standby-pile,
            .dead-pile {
                border: 1px solid #404040;
                background: #504f4f;
                width: 120px;
                height: 80px;
                z-index: 2;
                position: relative;
            }
            .standby-pile:before,
            .dead-pile:before {
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                color: #404040;
                text-transform: uppercase;
                margin: auto;
                height: 12px;
                font-size: 12px;
            }
            .dead-pile:before {
                content: "Dead Pile";
            }
            .standby-pile:before {
                content: "Standby Pile";
            }
            .standby-pile .idleCard {
                position: relative;
            }
            .card-aperture.focus,
            .turnCard.focus,
            .btn.focus {
                box-shadow: 0px 0px 5px 2px grey;
            }
            .card-aperture {
                width: 150px;
                height: 250px;
                border: 1px solid #404040;
                display: inline-block;
                background: #504f4f;
                border-radius: 8px;
                position: relative;
                z-index: 2;
            }
            .card-aperture:before {
                content: "Card";
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                color: #404040;
                text-transform: uppercase;
                margin: auto;
                height: 20px;
                font-size: 20px;
            }
            .card-aperture .cardFront,
            .card-aperture .cardBack,
            .card-aperture .card {
                border-radius: 8px;
            }
            .card-aperture.closed .card {
                cursor: pointer;
            }
            .card-aperture.closed.focus .card,
            .card-aperture.closed .card:hover {
                background: #545454;
            }
            .in-play {
                width: 300px;
                height: 500px;
                border: 1px solid #404040;
                display: inline-block;
                background: #504f4f;
                border-radius: 10px;
                z-index: 1;
                transition: .5s;
            }
            .in-play:before {
                content: "Caster";
                position: absolute;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                color: #404040;
                text-transform: uppercase;
                margin: auto;
                height: 30px;
                font-size: 30px;
            }
            .support-card-component {
                width: 150px;
                height: 250px;
                border: 3px solid #404040;
                display: inline-block;
                background: #504f4f;
                border-radius: 10px;
                z-index: 0;
                transition: .5s;
                position: absolute;
            }
            .support-card-component:after {
                content: "Support";
                text-transform: uppercase;
                color: #404040;
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                margin: auto;
                height: 20px;
                font-size: 20px;
                letter-spacing: 2px;
            }
            .battle-field[data-battle-field="player-field"] .support-card-component {
                bottom: 25px;
                left: 0;
            }
            .battle-field[data-battle-field="player-field"] .support-card-component.activeSupport {
                left: -155px;
            }
            .battle-field[data-battle-field="ai-field"] .support-card-component {
                top: 25px;
                right: 0;
            }
            .battle-field[data-battle-field="ai-field"] .support-card-component.activeSupport {
                right: -155px;
            }
            .support-card-circuit {
                position: absolute;
                width: 55px;
                height: 20px;
            }
            .battle-field[data-battle-field="player-field"] .support-card-circuit {
                right: -20px;
                bottom: -20px;
                border-left: 1px solid #404040;
                border-bottom: 1px solid #404040;
            }
            .battle-field[data-battle-field="ai-field"] .support-card-circuit {
                left: -20px;
                top: -20px;
                border-right: 1px solid #404040;
                border-top: 1px solid #404040;
            }
            .support-card-circuit:before,
            .support-card-circuit:after {
                content: "";
                position: absolute;
            }
            .battle-field[data-battle-field="player-field"] .support-card-circuit:before {
                left: -1px;
                bottom: -1px;
                border-left: 20px solid #404040;
                border-top: 20px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .support-card-circuit:before {
                right: -1px;
                top: -1px;
                border-right: 20px solid #404040;
                border-bottom: 20px solid transparent;
            }
            .battle-field[data-battle-field="player-field"] .support-card-circuit:after {
                left: -1px;
                bottom: -1px;
                border-left: 18px solid #504f4f;
                border-top: 18px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .support-card-circuit:after {
                right: -1px;
                top: -1px;
                border-right: 18px solid #504f4f;
                border-bottom: 18px solid transparent;
            }
            .hitpoint-indicator {
                border-radius: 8px;
                border: 1px solid #404040;
                position: absolute;
                height: 150px;
                width: 100px;
                padding: 5px;
                display: flex;
                flex-direction: column;
                justify-content: space-around;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-indicator {
                left: -120px;
                top: 50px;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-indicator {
                right: -120px;
                bottom: 50px;
            }
            .hitpoint-circuit {
                position: absolute;
                width: 57px;
                height: 37px;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-circuit {
                right: -43px;
                top: -37px;
                border-left: 1px solid #404040;
                border-top: 1px solid #404040;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-circuit {
                left: -43px;
                bottom: -37px;
                border-right: 1px solid #404040;
                border-bottom: 1px solid #404040;
            }
            .hitpoint-circuit:before {
                content: "";
                position: absolute;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-circuit:before {
                left: -1px;
                top: -1px;
                border-left: 25px solid #404040;
                border-bottom: 25px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-circuit:before {
                right: -1px;
                bottom: -1px;
                border-right: 25px solid #404040;
                border-top: 25px solid transparent;
            }
            .hitpoint-circuit:after {
                content: "";
                position: absolute;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-circuit:after {
                left: -1px;
                top: -1px;
                border-left: 23px solid #504f4f;
                border-bottom: 23px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-circuit:after {
                right: -1px;
                bottom: -1px;
                border-right: 23px solid #504f4f;
                border-top: 23px solid transparent;
            }
            .hitpoint-indicator:before, 
            .hitpoint-indicator:after {
                content: "";
                position: absolute;
                z-index: 2;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-indicator:before {
                left: 0;
                bottom: 0;
                border-left: 30px solid #404040;
                border-top: 35px solid transparent;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-indicator:after {
                left: -1px;
                bottom: -1px;
                border-left: 30px solid #504f4f;
                border-top: 35px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-indicator:before {
                right: 0;
                top: 0;
                border-right: 30px solid #404040;
                border-bottom: 35px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-indicator:after {
                right: -1px;
                top: -1px;
                border-right: 30px solid #504f4f;
                border-bottom: 35px solid transparent;
            }
            .hitpoint-meter {
                display: block;
                border: 1px solid #404040;
                height: 42px;
                margin-bottom: 5px;
                position: relative;
            }
            .hitpoint-meter:nth-child(2) {
                border-top-left-radius: 8px;
                border-top-right-radius: 8px;
            }
            .hitpoint-meter:last-child {
                border-bottom-left-radius: 8px;
                border-bottom-right-radius: 8px;
                margin-bottom: 0;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child:before, 
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child:after {
                content: "";
                position: absolute;
                z-index: 1;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2):before, 
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2):after {
                content: "";
                position: absolute;
                z-index: 1;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child:before {
                left: 0;
                bottom: 0;
                border-left: 28px solid #404040;
                border-top: 32px solid transparent;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child:after {
                left: -1px;
                bottom: -1px;
                border-left: 28px solid #504f4f;
                border-top: 32px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2):before {
                right: 0;
                top: 0;
                border-right: 28px solid #404040;
                border-bottom: 32px solid transparent;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2):after {
                right: -1px;
                top: -1px;
                border-right: 28px solid #504f4f;
                border-bottom: 32px solid transparent;
            }
            .hitpoint-meter div {
                display: block;
                height: 33%;
                transition: .5s;
                position: relative;
                background: transparent;
            }
            .hitpoint-meter:nth-child(2) div:first-child {
                border-top-left-radius: 8px;
                border-top-right-radius: 8px;
            }
            .hitpoint-meter:last-child div:last-child {
                border-bottom-left-radius: 8px;
                border-bottom-right-radius: 8px;
            }
            .hitpoint-meter.safe div.activeIndicator {
                background: #0a800f;
                box-shadow: inset 0px 0px 0px 2px #1b6d04;
            }
            .hitpoint-meter.caution div.activeIndicator {
                background: #ff6a00;
                box-shadow: inset 0px 0px 0px 2px #b14c05;
            }
            .hitpoint-meter.risk div.activeIndicator {
                background: #c0392b;
                box-shadow: inset 0px 0px 0px 2px #a21102;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child div:before {
                content: "";
                position: absolute;
                transform: rotate(-42deg);
                width: 3px;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child div.activeIndicator:before {
                background: #a21102;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child div:nth-child(1):before {
                height: 7px;
                left: 2px;
                bottom: 0px;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child div:nth-child(2):before {
                height: 15px;
                left: 10px;
                bottom: 0;
            }
            .battle-field[data-battle-field="player-field"] .hitpoint-meter:last-child div:nth-child(3):before {
                height: 15px;
                left: 21px;
                bottom: 0px;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2) div:before {
                content: "";
                position: absolute;
                transform: rotate(-42deg);
                width: 3px;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2) div.activeIndicator:before {
                background: #1b6d04;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2) div:nth-child(1):before {
                height: 15px;
                right: 22px;
                top: 0px;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2) div:nth-child(2):before {
                height: 15px;
                right: 10px;
                top: 0;
            }
            .battle-field[data-battle-field="ai-field"] .hitpoint-meter:nth-child(2) div:nth-child(3):before {
                height: 7px;
                right: 2px;
                top: 0px;
            }
            .resource-field-component {
                position: absolute;
                color: #404040;
            }
            .resource-field-component[data-resource-field="player-field"] {
                left: 15px;
                bottom: 50px;
            }
            .resource-field-component[data-resource-field="ai-field"] {
                right: 15px;
                top: 50px;
            }
            .resource-aperture {
                border: 1px solid #404040;
                border-radius: 5px;
                color: #b3b3b3;
                height: 40px;
                width: 55px;
                line-height: 50px;
                position: relative;
                margin: auto 10px;
            }
            .resource-field-component .resource {
                display: flex;
                align-items: center;
                margin-bottom: 10px;
                transition: .5s;
            }
            .resource-field-component .resource > div {
                display: inline-block;
                vertical-align: middle;
            }
            .resource-field-component .resource .fas {
                width: 35px;
                font-size: 25px;
                text-align: center;
                vertical-align: middle;
                transition: .5s;
            }
            .resource-field-component[data-resource-field="ai-field"] .resource-counter:after {
                content: "\00d7";
            }
            .resource-field-component[data-resource-field="ai-field"] .resource {
                justify-content: flex-end;
                text-align: right;
            }
            .resource-field-component[data-resource-field="player-field"] .resource {
                justify-content: flex-start;
                text-align: left;
            }
            .resource-field-component[data-resource-field="player-field"] .resource-counter:before {
                content: "\00d7";
            }
            .resource-counter {
                font-size: 15px;
                transition: .5s;
                overflow: hidden;
                color: #b3b3b3;
                border-radius: 100%;
                background: #404040;
                height: 0;
                width: 0;
                line-height: 35px;
                text-align: center;
            }
            .resource-counter:before, 
            .resource-counter:after {
                font-weight: 600;
            }
            .activePool .resource-counter {
                height: 35px;
                width: 35px;
            }
            .resource-field-component[data-resource-field="player-field"] .resource-counter {
                border-top-left-radius: 0;
            }
            .resource-field-component[data-resource-field="ai-field"] .resource-counter {
                border-top-right-radius: 0;
            }
            .resource-pyro.activePool .fas {
                color: #c0392b;
            }
            .resource-terra.activePool .fas {
                color: #27ae60;
            }
            .resource-aero.activePool .fas {
                color: #f1c40f;
            }
            .resource-hydro.activePool .fas {
                color: #3498db;
            }
            .display-resource-value:before {
                content: "\00d7";
            }
            .display-resource-value {
                position: absolute;
                display: block;
                width: 0;
                height: 0;
                font-size: 15px;
                margin: auto;
                border-radius: 100%;
                border-bottom-left-radius: 0;
                text-align: center;
                line-height: 25px;
                transition: .5s;
                overflow: hidden;
                z-index: 9;
            }
            .activeResourceTag {
                width: 25px;
                height: 25px;
            }
            .display-resource-value.aero-tag {
                background: #f1c40f;
                color: #404040;
            }
            .display-resource-value.terra-tag {
                background: #27ae60;
                color: white;
            }
            .display-resource-value.hydro-tag {
                background: #3498db;
                color: white;
            }
            .display-resource-value.pyro-tag {
                background: #c0392b;
                color: white;
            }
            /* || Dialogue Boxes */
            .dialogueBox {
                position: fixed;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                display: flex;
                align-items: center;
                transition: .5s;
                overflow: hidden;
                z-index: 99;
            }
            .dialogueBox.minimized-dialogueBox {
                top: calc(100% - 55px);
                bottom: 0;
                left: calc(100% - 300px);
                right: 0;
                width: 300px;
                height: 55px;
            }
            .dialogueBox-backdrop {
                position: fixed;
                top: 0;
                bottom: 0;
                left: 0;
                right: 0;
                background: rgba(80, 79, 79, 0.5);
                cursor: pointer;
                transition: .3s;
            }
            .dialogueBox-component {
                background: #504f4f;
                border: 3px solid #404040;
                max-width: 500px;
                max-height: 250px;
                margin: auto;
                display: block;
                position: absolute;
                left: 0;
                right: 0;
                top: 0;
                bottom: 0;
                border-radius: 5px;
                z-index: 1;
                color: #b3b3b3;
                overflow: hidden;
                transition: .5s;
            }
            .minimized-dialogueBox .dialogueBox-component {
                width: 100%;
                max-height: 55px;
                top: 0;
                left: 0;
            }
            .minimized-dialogueBox .dialogueBox-backgraound .card-motivs {
                bottom: -500px;
            }
            .dialogueBox-head {
                padding: 15px;
                border-bottom: 1px solid #404040;
                position: relative;
                height: 50px;
                display: block;
                z-index: 1;
            }
            .dialogueBox-dismiss {
                top: 0;
                bottom: 0;
                right: 0;
                border-left: 1px solid #404040;
            }
            .dialogueBox-minimize, 
            .dialogueBox-maximize {
                display: none;
                top: 0;
                bottom: 0;
                left: 0;
                border-right: 1px solid #404040;
            }
            .dialogueBox-control {
                position: absolute;
                color: #404040;
                width: 50px;
                line-height: 50px;
                text-align: center;
                cursor: pointer;
                transition: .5s;
            }
            .dialogueBox-control:hover {
                background: #404040;
                color: #b3b3b3;
            }
            .dialogueBox-body {
                padding: 15px;
                min-height: 150px;
                display: flex;
                align-items: center;
                justify-content: center;
                position: relative;
                z-index: 1;
            }
            .dialogueBox-component .card-motivs {
                top: 0;
                bottom: 0;
                border-color: #4a4a4a;
                width: 100px;
                height: 100px;
            }
            .dialogueBox-component .card-motivs .fas {
                color: #4a4a4a;
                font-size: 25px;
            }
            .card-motivs .fas:nth-child(1) {
                top: -10px;
            }
            .card-motivs .fas:nth-child(2) {
                right: -7px;
            }
            .card-motivs .fas:nth-child(3) {
                bottom: -10px;
            }
            .card-motivs .fas:nth-child(4) {
                left: -7px;
            }
            .inactive-dialogueBox .dialogueBox-component {
                height: 0;
                width: 0;
            }
            .active-dialogueBox .dialogueBox-component {
                width: 100%;
                height: 100%;
            }
            .active-dialogueBox .dialogueBox-backdrop {
                opacity: 1;
            }
            .inactive-dialogueBox .dialogueBox-backdrop {
                opacity: 0;
            }
            .minimized-dialogueBox .dialogueBox-backdrop {
                opacity: 0;
                top: auto;
            }
            .turn-result {
                text-align: center;
                font-size: 50px;
                font-style: italic;
            }
            .turn-result sup {
                text-transform: uppercase;
                font-size: 20px;
            }
            .turn-order {
                font-size: 20px;
            }
            .confirm-hand {
                text-align: center;
                font-size: 20px;
            }
            .confirm-options {
                margin-top: 15px;
            }
            .confirm-options .btn {
                margin: 0 10px;
            }
            .confirm-options .btn:nth-child(3):last-child {
                display: block;
                max-width: 155px;
                margin: auto;
                position: relative;
                top: 20px;
            }
            .invalid-draw-notice {
                text-align: center;
                font-size: 35px;
            }
            .invalid-draw-notice-detail {
                font-size: 20px;
            }
            /* || Transitions */
            .speedX2 {
                transition: .2s;
            }
            .speedX5 {
                transition: .5s;
            }
            .speedX7 {
                transition: .7s;
            }
        </style>
    </body>
</html>
